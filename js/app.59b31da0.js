(function(t){function e(e){for(var i,s,o=e[0],l=e[1],c=e[2],u=0,d=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&d.push(a[s][0]),a[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);h&&h(e);while(d.length)d.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,o=1;o<n.length;o++){var l=n[o];0!==a[l]&&(i=!1)}i&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},a={app:0},r=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var h=l;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0c4e":function(t,e,n){"use strict";var i=n("2e40"),a=n.n(i);a.a},1:function(t,e){},2:function(t,e){},"2e40":function(t,e,n){},3:function(t,e){},4678:function(t,e,n){var i={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function a(t){var e=r(t);return n(e)}function r(t){if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}a.keys=function(){return Object.keys(i)},a.resolve=r,t.exports=a,a.id="4678"},"51f2":function(t,e,n){"use strict";n.r(e),e["default"]=n.p+"e452c15f48fdd4b19f51a37672e837f7.csv"},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("Layout",[n("Header",[n("h1",{staticClass:"layout-logo"},[t._v("KD-Box")]),n("Menu",{attrs:{mode:"horizontal",theme:"dark"},on:{"on-select":t.eventHandler}},[n("div",{staticClass:"layout-nav"},[n("Upload",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"upload",attrs:{action:"/","before-upload":t.readFileHandler}}),n("Submenu",{attrs:{name:"3"}},[n("template",{slot:"title"},[n("Icon",{attrs:{type:"ios-archive"}}),t._v(" Example data ")],1),n("MenuItem",{attrs:{name:"1-1"}},[t._v("Stocks(25.2MB)")]),n("MenuItem",{attrs:{name:"1-2"}},[t._v("Airline(10.6MB)")]),n("MenuItem",{attrs:{name:"1-3"}},[t._v("Weather(29.6MB)")]),n("MenuItem",{attrs:{name:"1-4"}},[t._v("Reading(18.5MB)")]),n("MenuItem",{attrs:{name:"1-5"}},[t._v("HardDrive(66.3MB)")])],2),n("MenuItem",{attrs:{name:"2"}},[n("Icon",{attrs:{type:"ios-cloud-upload-outline"}}),t._v(" Load data ")],1)],1)])],1),n("Content",{style:{width:"1850px",margin:"0 auto",padding:"0 50px",display:"flex",flexDirection:"row"}},[n("Card",{staticClass:"sticky-content"},[n("div",[n("Button",{staticStyle:{width:"200px"},attrs:{type:"info"},on:{click:function(e){return t.eventHandler("2")}}},[n("Icon",{attrs:{type:"ios-cloud-upload-outline"}}),t._v(" Load data ")],1),n("Poptip",{staticStyle:{width:"200px",display:"block"}},[n("Button",{staticStyle:{width:"200px"}},[t._v("Example Data")]),n("div",{staticStyle:{display:"flex","flex-direction":"column"},attrs:{slot:"content"},slot:"content"},[n("Button",{staticStyle:{width:"200px"},on:{click:function(e){return t.eventHandler("1-1")}}},[t._v("Stocks(25.2MB)")]),n("Button",{staticStyle:{width:"200px"},on:{click:function(e){return t.eventHandler("1-2")}}},[t._v("Airline(10.6MB)")]),n("Button",{staticStyle:{width:"200px"},on:{click:function(e){return t.eventHandler("1-3")}}},[t._v("Weather(29.6MB)")]),n("Button",{staticStyle:{width:"200px"},on:{click:function(e){return t.eventHandler("1-4")}}},[t._v("Reading(18.5MB)")]),n("Button",{staticStyle:{width:"200px"},on:{click:function(e){return t.eventHandler("1-5")}}},[t._v("HardDrive(66.3MB)")])],1)],1),n("Upload",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"upload",attrs:{action:"/","before-upload":t.readFileHandler}}),n("p",{staticStyle:{"margin-top":"100px"}},[t._v("Line Aggregation Attribute:")]),n("Select",{staticStyle:{width:"200px"},model:{value:t.aggregateAttr,callback:function(e){t.aggregateAttr=e},expression:"aggregateAttr"}},t._l(t.headers,(function(e,i){return n("Option",{key:i,attrs:{value:i}},[t._v(t._s(e)+" ")])})),1),n("p",[t._v("Time Attribute:")]),n("Select",{staticStyle:{width:"200px"},model:{value:t.timeAttr,callback:function(e){t.timeAttr=e},expression:"timeAttr"}},[t._l(t.headers,(function(e,i){return["string"!=t.inferTypes[i]?n("Option",{key:i,attrs:{value:i}},[t._v(t._s(e)+" ")]):t._e()]}))],2),n("p",[t._v("Value Attribute:")]),n("Select",{staticStyle:{width:"200px"},model:{value:t.valueAttr,callback:function(e){t.valueAttr=e},expression:"valueAttr"}},[t._l(t.headers,(function(e,i){return["number"==t.inferTypes[i]?n("Option",{key:i,attrs:{value:i}},[t._v(t._s(e)+" ")]):t._e()]}))],2),n("br"),n("br"),n("p",[t._v("Resolution:")]),n("div",{staticStyle:{"margin-bottom":"20px"}},[n("InputNumber",{model:{value:t.canvasWidth,callback:function(e){t.canvasWidth=e},expression:"canvasWidth"}}),n("Icon",{attrs:{type:"ios-close"}}),n("InputNumber",{model:{value:t.canvasHeight,callback:function(e){t.canvasHeight=e},expression:"canvasHeight"}})],1),n("Button",{staticStyle:{width:"200px"},attrs:{type:"primary",disabled:!t.headers.length},on:{click:t.generateCharts}},[t._v("generate chart ")]),n("div",{staticStyle:{"margin-top":"100px"}},[n("Button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:t.exportFig}},[t._v("export figure ")]),n("br"),n("Button",{staticStyle:{"margin-top":"12px",width:"200px"},attrs:{type:"primary"},on:{click:function(e){return t.exportData(1)}}},[t._v("export representative lines ")]),n("br"),n("Button",{staticStyle:{"margin-top":"12px",width:"200px"},attrs:{type:"primary"},on:{click:function(e){return t.exportData(0)}}},[t._v("export select lines ")])],1)],1)]),n("Card",{staticStyle:{"padding-left":"20px","flex-grow":"1"},attrs:{"dis-hover":"",bordered:!1}},[t.headers.length?n("div",[t.chartConfigs.length?n("div",[t._l(t.chartConfigs,(function(e,i){return[n("CanvasBox",{key:e.aggregateName+"#"+e.timeName+"#"+e.valueName+"#"+t.width+"#"+t.height,attrs:{timeIndex:e.timeIndex,valueIndex:e.valueIndex,timeName:e.timeName,valueName:e.valueName,filter:e.filter,layers:t.layers,option:{height:t.height,width:t.width}},on:{filterChange:function(e){return t.handleFilterChange(i,e)}}})]}))],2):n("div",{staticStyle:{"min-height":"200px",color:"red"}},[t._v(" Please use a valid configuration in left panel! ")])]):n("div",{staticStyle:{"min-height":"200px",color:"red"}},[t._v(" Please load a dataset (.csv file) first! "),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-archive"},on:{click:function(e){return t.eventHandler("1-1")}}},[t._v("Example Stocks(25.2MB) ")]),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-archive"},on:{click:function(e){return t.eventHandler("1-2")}}},[t._v("Example Airline(10.6MB) ")]),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-archive"},on:{click:function(e){return t.eventHandler("1-3")}}},[t._v("Example Weather(29.6MB) ")]),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-archive"},on:{click:function(e){return t.eventHandler("1-4")}}},[t._v("Example Reading(18.5MB) ")]),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-archive"},on:{click:function(e){return t.eventHandler("1-5")}}},[t._v("Example HardDrive(66.3MB) ")]),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-cloud-upload-outline"},on:{click:function(e){return t.eventHandler("2")}}},[t._v("Load data ")])],1)])],1)],1)],1)},r=[],s=(n("99af"),n("4de4"),n("7db0"),n("4160"),n("caad"),n("c975"),n("a15b"),n("d81d"),n("13d5"),n("fb6a"),n("a434"),n("ace4"),n("4ec9"),n("4fad"),n("d3b7"),n("ac1f"),n("25f0"),n("6062"),n("2532"),n("3ca3"),n("1276"),n("2ca0"),n("cfc3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("159b"),n("ddb0"),n("2909")),o=n("5530"),l=n("3835"),c=n("b85c"),h=n("ade3");n("b5bb"),n("9389"),n("4b31"),n("7f6b");function u(t,e,n){var i=document.createElement("canvas");i.width=1e3,i.height=500;var a=i.getContext("2d");for(var r in e&&a.scale(1,-1),console.log(n),t){var s=t[r];a.globalAlpha=n?n[r]:1,a.drawImage(s,0,e?-s.height:0)}var o=document.createElement("a");o.href=i.toDataURL().replace(/^data:image\/[^;]*/,"data:application/octet-stream"),o.download="export.png",o.click()}var d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center",margin:"15px 0 15px 20px",position:"relative"}},[n("div",{staticStyle:{width:"1000px",height:"500px",opacity:"0","pointer-events":"none"},attrs:{id:"blank-div"}}),n("canvas",{staticStyle:{transform:"scaleY(1)",position:"absolute",left:"0",top:"0"},attrs:{id:"canvas",width:t.option.width,height:t.option.height},on:{mousedown:t.canvasMousedown,mouseup:t.canvasMouseup,mousemove:t.canvasMousemove,wheel:t.canvasWheel,contextmenu:t.mouseContextmenu,mouseleave:t.canvasMouseleave}}),n("canvas",{staticStyle:{transform:"scaleY(1)",position:"absolute",left:"0",top:"0","pointer-events":"none"},attrs:{id:"selectionCanvas",width:t.option.width,height:t.option.height}}),n("canvas",{staticStyle:{transform:"scaleY(1)",position:"absolute",left:"0",top:"0","pointer-events":"none"},attrs:{id:"selectionLayer",width:"1000",height:"500"}}),n("canvas",{staticStyle:{transform:"scaleY(1)",position:"absolute",left:"0",top:"0","pointer-events":"none"},attrs:{id:"rep_layer",width:"1000",height:"500"}}),n("canvas",{staticStyle:{transform:"scaleY(1)",position:"absolute",left:"0",top:"0","pointer-events":"none"},attrs:{id:"raw_lines",width:"1000",height:"500"}}),n("canvas",{staticStyle:{transform:"scaleY(1)",position:"absolute",left:"0",top:"0","pointer-events":"none","z-index":"999"},attrs:{id:"mouseLayer",width:"1000",height:"500"}}),n("canvas",{staticStyle:{transform:"scaleY(1)",position:"absolute",left:"0",top:"0","pointer-events":"none","z-index":"999"},attrs:{id:"hoverLayer",width:"1000",height:"500"}}),n("svg",{staticStyle:{position:"absolute",left:"-50px",top:"-20px","pointer-events":"none",color:"black","z-index":"999",overflow:"visible"},attrs:{id:"axisHelper",width:1050,height:550}},[n("g",{attrs:{id:"cursorHelper",transform:"translate(50,20)"}},[n("line",{attrs:{stroke:"black","stroke-dasharray":"10 5"}}),n("line",{attrs:{stroke:"black","stroke-dasharray":"10 5"}}),n("text",{attrs:{"font-size":"12px"}}),n("text",{attrs:{"font-size":"12px"}})])]),n("div",{ref:"axisTop",staticStyle:{width:"1000px",height:"30px",position:"absolute",top:"-30px",left:"0"}}),n("div",{ref:"axisBottom",staticStyle:{width:"1000px",height:"30px",position:"absolute",bottom:"-30px",left:"0"}}),n("div",{ref:"axisLeft",staticStyle:{width:"30px",height:"500px",position:"absolute",top:"0px",left:"-30px"}}),n("div",{staticClass:"control-panel"},[n("div",[n("span",[t._v("Filter line by: ")]),n("RadioGroup",{attrs:{type:"button"},model:{value:t.filterMode,callback:function(e){t.filterMode=e},expression:"filterMode"}},[n("Radio",{attrs:{label:"rnn"}},[t._v("RNL")]),n("Radio",{attrs:{label:"brush"}},[t._v("Brush")]),n("Radio",{attrs:{label:"ang"}},[t._v("Angle")]),n("Radio",{attrs:{label:"attr"}},[t._v("Attr")]),n("Radio",{attrs:{label:"hover"}},[t._v("Hover")])],1)],1),"attr"===t.filterMode?n("div",{staticStyle:{"margin-left":"2em"}},[n("Form",[n("FormItem",{attrs:{label:"Attribute Column"}},[n("Select",{attrs:{placeholder:"Choose a column for attribute filtering"},model:{value:t.attributeColumn,callback:function(e){t.attributeColumn=e},expression:"attributeColumn"}},t._l(t.headers,(function(e){return n("Option",{key:e.title,attrs:{value:e.key}},[t._v(t._s(e.title)+" ")])})),1)],1),n("FormItem",{attrs:{label:"Value"}},[n("AutoComplete",{attrs:{data:t.attributeData},on:{"on-search":t.handleSearch},model:{value:t.attributeValue,callback:function(e){t.attributeValue=e},expression:"attributeValue"}})],1),n("Button",{staticStyle:{float:"right"},attrs:{type:"info"},on:{click:t.addAttrQuery}},[t._v("add attribute query ")])],1)],1):t._e(),t._m(0),"rep"==t.rawMode?n("div",{staticStyle:{"margin-left":"2em"}},[n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("span",{staticStyle:{"margin-right":"8px"}},[t._v("Line count")]),n("Slider",{staticStyle:{"flex-grow":"1"},attrs:{min:1,max:20,step:1,"show-tip":"never"},model:{value:t.repCount,callback:function(e){t.repCount=e},expression:"repCount"}}),n("span",{staticStyle:{"margin-left":"8px"}},[t._v(t._s(t.repCount))]),n("span",{staticStyle:{"margin-right":"8px","margin-left":"12px"}},[t._v("Diverse")]),n("Slider",{staticStyle:{"flex-grow":"1"},attrs:{min:0,max:t.maxDiverse,step:t.maxDiverse/20,"show-tip":"never"},on:{"on-change":function(e){t.cnt++}},model:{value:t.diverse,callback:function(e){t.diverse=e},expression:"diverse"}})],1),n("div",{staticStyle:{display:"flex","align-items":"center"}})]):t._e(),n("div",{staticStyle:{position:"relative"}},[n("div",{staticClass:"select-colormap"},[n("span",{staticStyle:{margin:"0"}},[t._v("Colormap:")]),n("Select",{attrs:{id:"colormap",placeholder:"Choose colormap"},model:{value:t.colormapIndexCache,callback:function(e){t.colormapIndexCache=e},expression:"colormapIndexCache"}},[n("Option",{attrs:{value:"0"}},[t._v("viridis")]),n("Option",{attrs:{value:"1",selected:""}},[t._v("magma")]),n("Option",{attrs:{value:"2"}},[t._v("inferno")]),n("Option",{attrs:{value:"3"}},[t._v("plasma")]),n("Option",{attrs:{value:"4"}},[t._v("cividis")]),n("Option",{attrs:{value:"5"}},[t._v("turbo")]),n("Option",{attrs:{value:"6"}},[t._v("bluegreen")]),n("Option",{attrs:{value:"7"}},[t._v("bluepurple")]),n("Option",{attrs:{value:"8"}},[t._v("goldgreen")]),n("Option",{attrs:{value:"9"}},[t._v("goldorange")]),n("Option",{attrs:{value:"10"}},[t._v("goldred")]),n("Option",{attrs:{value:"11"}},[t._v("greenblue")]),n("Option",{attrs:{value:"12"}},[t._v("orangered")]),n("Option",{attrs:{value:"13"}},[t._v("purplebluegreen")]),n("Option",{attrs:{value:"14"}},[t._v("purpleblue")]),n("Option",{attrs:{value:"15"}},[t._v("purplered")]),n("Option",{attrs:{value:"16"}},[t._v("redpurple")]),n("Option",{attrs:{value:"17"}},[t._v("yellowgreenblue")]),n("Option",{attrs:{value:"18"}},[t._v("yellowgreen")]),n("Option",{attrs:{value:"19"}},[t._v("yelloworangebrown")]),n("Option",{attrs:{value:"20"}},[t._v("yelloworangered")])],1)],1),n("span",[t._v("1")]),n("span",{staticClass:"color-map",attrs:{id:"color-map"}}),n("InputNumber",{staticStyle:{width:"50px"},attrs:{min:1,"active-change":!1},model:{value:t.maxDensity,callback:function(e){t.maxDensity=e},expression:"maxDensity"}})],1),t._m(1),n("div",{staticStyle:{"margin-left":"2em"}},[n("draggable",{model:{value:t.layers,callback:function(e){t.layers=e},expression:"layers"}},t._l(t.layers,(function(e){return n("div",{key:e.id,staticStyle:{display:"flex","align-items":"center",border:"1px solid #dcdee2","margin-top":"4px",background:"white",cursor:"pointer","border-radius":"4px",padding:"0 8px"}},[n("Icon",{staticStyle:{cursor:"move"},attrs:{type:"md-menu"}}),n("div",{staticStyle:{"flex-grow":"1"}},[n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("p",{staticStyle:{width:"170px","padding-left":"12px"}},[t._v(" "+t._s(e.name)+" ")]),n("Icon",{style:{opacity:.7*e.opacity+.3},attrs:{type:0===e.opacity?"md-eye-off":"md-eye"},on:{click:function(t){e.opacity=0===e.opacity?1:0}}}),n("Slider",{staticStyle:{"flex-grow":"1","margin-left":"12px","margin-right":"8px"},attrs:{min:0,max:1,step:.01,"show-tip":"never"},model:{value:e.opacity,callback:function(n){t.$set(e,"opacity",n)},expression:"layer.opacity"}})],1),"selectionCanvas"==e.id?n("div",{staticStyle:{display:"flex","align-items":"center",margin:"0 12px 8px",position:"relative"}},[n("div",{staticClass:"select-colormap"},[n("span",{staticStyle:{margin:"0"}},[t._v("Colormap:")]),n("Select",{attrs:{id:"colormapOverlay",placeholder:"Choose colormap"},model:{value:t.colormapOverlayIndexCache,callback:function(e){t.colormapOverlayIndexCache=e},expression:"colormapOverlayIndexCache"}},[n("Option",{attrs:{value:"0"}},[t._v("viridis")]),n("Option",{attrs:{value:"1",selected:""}},[t._v("magma")]),n("Option",{attrs:{value:"2"}},[t._v("inferno")]),n("Option",{attrs:{value:"3"}},[t._v("plasma")]),n("Option",{attrs:{value:"4"}},[t._v("cividis")]),n("Option",{attrs:{value:"5"}},[t._v("turbo")]),n("Option",{attrs:{value:"6"}},[t._v("bluegreen")]),n("Option",{attrs:{value:"7"}},[t._v("bluepurple")]),n("Option",{attrs:{value:"8"}},[t._v("goldgreen")]),n("Option",{attrs:{value:"9"}},[t._v("goldorange")]),n("Option",{attrs:{value:"10"}},[t._v("goldred")]),n("Option",{attrs:{value:"11"}},[t._v("greenblue")]),n("Option",{attrs:{value:"12"}},[t._v("orangered")]),n("Option",{attrs:{value:"13"}},[t._v("purplebluegreen")]),n("Option",{attrs:{value:"14"}},[t._v("purpleblue")]),n("Option",{attrs:{value:"15"}},[t._v("purplered")]),n("Option",{attrs:{value:"16"}},[t._v("redpurple")]),n("Option",{attrs:{value:"17"}},[t._v("yellowgreenblue")]),n("Option",{attrs:{value:"18"}},[t._v("yellowgreen")]),n("Option",{attrs:{value:"19"}},[t._v("yelloworangebrown")]),n("Option",{attrs:{value:"20"}},[t._v("yelloworangered")])],1)],1),n("span",[t._v("1")]),n("span",{staticClass:"color-map",attrs:{id:"color-map-overlay"}}),n("InputNumber",{staticStyle:{width:"50px"},attrs:{min:1,"active-change":!1},model:{value:t.maxOverlayDensity,callback:function(e){t.maxOverlayDensity=e},expression:"maxOverlayDensity"}})],1):t._e()])],1)})),0)],1),n("div",[n("span",[t._v("Show value of cursor:")]),n("iSwitch",{staticStyle:{"margin-left":"12px"},model:{value:t.showCursorValue,callback:function(e){t.showCursorValue=e},expression:"showCursorValue"}})],1),n("div",[n("span",[t._v("Reverse y-axis:")]),n("iSwitch",{staticStyle:{"margin-left":"12px"},model:{value:t.upsideDown,callback:function(e){t.upsideDown=e},expression:"upsideDown"}})],1),n("div",[n("span",[t._v("Normalize density:")]),n("iSwitch",{staticStyle:{"margin-left":"12px"},model:{value:t.normalizeDensity,callback:function(e){t.normalizeDensity=e},expression:"normalizeDensity"}})],1),n("div",[n("span",[t._v("Enlarge Axis Font Size:")]),n("iSwitch",{staticStyle:{"margin-left":"12px"},model:{value:t.enlargeFont,callback:function(e){t.enlargeFont=e},expression:"enlargeFont"}})],1)])]),n("Table",{staticStyle:{"margin-top":"30px"},attrs:{"row-class-name":t.calClassName,border:"",columns:t.tableColumns,data:t.cnt+1&&t.tableData,"on-current-change":t.hoveringQuery,id:"informationTable"},scopedSlots:t._u([{key:"name",fn:function(e){var i=e.row,a=e.index;return[a>=t.tableData.length-2?n("p",{staticStyle:{"font-style":"italic","font-weight":"700"}},[t._v(" "+t._s(i.name)+" ")]):n("div",[t._v(t._s(i.name))])]}},{key:"op",fn:function(e){var i=e.row,a=e.index;return[n("Button",{staticStyle:{"margin-right":"5px"},attrs:{ghost:"",type:i.query===t.selectedQuery?"primary":"default",size:"small"},on:{click:function(e){t.selectedQuery=i.query}}},[t._v("Explore ")]),a<t.tableData.length-2?n("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.deleteQuery(a)}}},[t._v("Delete ")]):t._e()]}}])}),n("Button",{staticStyle:{float:"right",margin:"20px"},attrs:{type:"error",size:"small"},on:{click:t.deleteAllQuery}},[t._v(" Delete all Querys ")]),n("Modal",{attrs:{width:"1000",closable:!1},model:{value:t.repModal,callback:function(e){t.repModal=e},expression:"repModal"}},[n("p",{staticStyle:{color:"dodgerblue","text-align":"center"},attrs:{slot:"header"},slot:"header"},[n("Icon",{attrs:{type:"ios-information-circle"}}),n("span",[t._v("Representative Line Information")])],1),n("Table",{attrs:{border:"",columns:t.repColumns,data:t.repStaticInformation}}),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"primary",size:"large",long:""},on:{click:function(e){t.repModal=!1}}},[t._v("Confirm ")])],1)],1)],1)},f=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("span",[t._v("Representative line parameters: ")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("span",[t._v("Layers:")])])}],p=(n("cb29"),n("b0c0"),n("2af1"),n("a9e3"),n("b680"),n("07ac"),n("8a59"),n("b76a")),v=n.n(p),y={data:[],aggregatedData:[],headers:[],interResult:[],unionResult:[],querys:[],repIds:[],weightCache:{}};n("7dbb");var m=n("5698"),g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Table",{attrs:{columns:t.repColumns,data:t.row},scopedSlots:t._u([{key:"name",fn:function(e){var i=e.row;return[n("div",{staticStyle:{display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}},[n("div",{staticClass:"small-point",style:{background:i.color}}),n("p",[t._v(t._s(i.name))])])]}},{key:"op",fn:function(e){var i=e.row;return[n("Button",{attrs:{ghost:"",type:"primary",size:"small"},on:{click:function(e){return t.showData(i)}}},[t._v("Detail ")])]}}])})},x=[],b={name:"expandRow",props:{row:Array},data:function(){return{repColumns:[{title:'Line "'.concat(y.aggregateName,'"'),align:"center",slot:"name"},{title:"Min value",align:"center",key:"minV"},{title:"Max value",align:"center",key:"maxV"},{title:"Mean value",align:"center",key:"mean"},{title:"Variance",align:"center",key:"var"},{title:"Operation",align:"center",slot:"op"}]}},methods:{showData:function(t){var e=y.headers.indexOf(y.aggregateName);this.$Modal.info({width:1e3,closable:!0,render:function(n){return n("div",[n("svg",{attrs:{id:"rep-line-svg",viewBox:"0 0 1050 550"},style:{height:"550px",width:"950px"}}),n("Table",{props:{columns:y.headers.map((function(t,e){return{title:t,align:"center",key:e}})),data:y.data.filter((function(n){return n[e]==t.name})).map((function(t){return t.reduce((function(t,e,n){return Object(o["a"])(Object(o["a"])({},t),{},Object(h["a"])({},n,e))}),{})})),stripe:!0}})])}}),this.$nextTick().then((function(){console.log("svgsvg");var e=m["j"]("#rep-line-svg");console.log(e),e.append("g").attr("id","yaxis").attr("transform","translate(50,20)").call(y.yAxis),e.append("g").attr("id","xaxis").attr("transform","translate(50,".concat(y.upsideDown?20:520,")")).call(y.upsideDown?y.xAxisR:y.xAxis),e.append("g").attr("transform","translate(50,20)").append("path").attr("d",m["d"]()(y.screenResult[t.id].map((function(t){var e=t.x,n=t.y;return[e,y.upsideDown?500-n:n]})))).attr("stroke",t.color).attr("fill","none")}))}}},w=b,M=(n("72cd"),n("2877")),C=Object(M["a"])(w,g,x,!1,null,null,null),j=C.exports,k=(n("a630"),n("841c"),n("10d1"),n("1fe2"),n("d4ec")),S=n("bee2"),O=n("34d8");n("9bd1"),n("5364"),n("fa35"),n("a6c1"),n("175a"),n("ec78").default,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakSet;new WeakMap,new WeakMap,new WeakMap,new WeakSet,new WeakSet,new WeakSet,new WeakSet;function D(t,e,n){var i=Math.max(Math.min((n-t.x)/(e.x-t.x),1),0),a=1-i;return{x:t.x*a+e.x*i,y:t.y*a+e.y*i}}function L(t,e){if(t[0]===e[0])throw console.log(t,e),Error("Same x coordinate");return Math.atan((e[1]-t[1])/(e[0]-t[0]))}function _(t){return t*t}function I(t,e){return _(t[0]-e[0])+_(t[1]-e[1])}function z(t,e){return Math.abs(t-e)<=1}var A=function(t,e,n){z(t[0],e[0])&&(t[0]=n[0]),z(t[1],e[1])&&(t[1]=n[1])},B=function(t,e,n){t[0]+=e,t[1]+=n};function E(t,e,n){var i=I(e,n);if(0===i)return I(t,e);var a=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/i;return a=Math.max(0,Math.min(1,a)),I(t,[e[0]+a*(n[0]-e[0]),e[1]+a*(n[1]-e[1])])}function T(t,e){var n={x:t.x1,y:t.y1},i={x:t.x2,y:t.y2},a={x:e.x,y:e.y},r={x:e.x+e.width,y:e.y};if(H(n,i,a,r))return!0;a=r,r={x:e.x+e.width,y:e.y+e.height};if(H(n,i,a,r))return!0;a=r,r={x:e.x,y:e.y+e.height};if(H(n,i,a,r))return!0;a=r,r={x:e.x,y:e.y};return!!H(n,i,a,r)}function H(t,e,n,i){var a=(i.x-n.x)*(t.y-n.y)-(i.y-n.y)*(t.x-n.x),r=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),s=(i.y-n.y)*(e.x-t.x)-(i.x-n.x)*(e.y-t.y);if(0==a&&0==r&&0==s)return null;if(0==s)return null;a/=s,r/=s;var o=a>=0&&a<=1&&r>=0&&r<=1;return o}function R(t){if(t.length<3)return[];for(var e=[],n=1;n<t.length-1;n++){var i=t[n].x-t[n-1].x+.001,a=t[n+1].x-t[n].x+.001,r=Math.min(i,a),s=t[n-1],o=t[n+1];i<a?o=D(t[n],o,t[n].x+i):s=D(t[n-1],t[n],t[n].x-a);var l=(o.y-s.y)/r,c=(s.y-2*t[n].y+o.y)/(r*r);isNaN(c)&&console.log(i,a,t[n-1],t[n],t[n+1]),e.push({x:t[n].x,y:Math.abs(c)/Math.pow(1+l*l,1.5)})}return e}function P(t,e,n){var i=0,a=0,r=0,s=0;while(r<t.length&&s<e.length){if(t[r].x<e[s].x){if(0!==s){var o=D(e[s-1],e[s],t[r].x);a+=Math.abs(o.y-t[r].y),i++}r++}else if(e[s].x<t[r].x){if(0!==r){var l=D(t[r-1],t[r],e[s].x);a+=Math.abs(l.y-e[s].y),i++}s++}else a+=Math.abs(t[r].y-e[s].y),i++,r++,s++;if(isNaN(a))return.001}return 0===i?1e-4:a/i}function q(t,e,n,i){var a=Math.floor(t[1].x),r=Math.floor(t[1].y),s=Math.floor(t[0].x),o=Math.floor(t[0].y);if(a!=s)return Math.abs(r-o)>Math.abs(a-s)?r<o?F(a,r,s,o,e,n,i):F(s,o,a,r,e,n,i):a<s?Y(a,r,s,o,e,n,i):Y(s,o,a,r,e,n,i)}function Y(t,e,n,i,a,r,s){var o=Math.min(1,Math.abs(1/s));isFinite(o)&&!isNaN(o)||(o=1);for(var l=n-t,c=i-e,h=c<0?(c=-c,-1):1,u=2*c-l,d=!0,f=t,p=e;f<=n;++f,u+=2*c){var v;if(f>=0&&f<a.length&&p>=0&&p<a[0].length)d?d=!1:a[f][p][r]=(null!==(v=a[f][p][r])&&void 0!==v?v:0)+o;u>0&&(p+=h,u-=2*l)}}function F(t,e,n,i,a,r,s){var o=Math.min(1,Math.abs(1/s));isFinite(o)&&!isNaN(o)||(o=1);for(var l=n-t,c=i-e,h=l<0?(l=-l,-1):1,u=2*l-c,d=!0,f=t,p=e;p<=i;++p,u+=2*l){var v;if(f>=0&&f<a.length&&p>=0&&p<a[0].length)d?d=!1:a[f][p][r]=(null!==(v=a[f][p][r])&&void 0!==v?v:0)+o;u>0&&(f+=h,u-=2*c)}}n("5cc6"),n("84c3"),n("fb2c");var N=n("175a"),W=n.n(N),X={deg:3,b:1.128,k:5,r:.05,cuveq:.06},$={},Q=new WeakSet,V=new WeakSet,U=new WeakSet,K=new WeakSet,G=new WeakSet,J=new WeakSet,Z=new WeakSet,tt=new WeakSet,et=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;Object(k["a"])(this,t),tt.add(this),Z.add(this),J.add(this),G.add(this),K.add(this),U.add(this),V.add(this),Q.add(this),Object(h["a"])(this,"root",null),Object(h["a"])(this,"segs",[]);var i={pos:void 0,cuv:void 0,offsets:void 0,sizes:void 0,fastID:void 0,lineID:[],segIndex:[]},a=e.reduce((function(t,e){return t+e.length}),0),r=e.reduce((function(t,e){return Math.max(t,e.length)}),0),s=e.length>65535?Uint32Array:Uint16Array,o=a>65535?Uint32Array:Uint16Array,l=r>65535?Uint32Array:r>127?Uint16Array:Uint8Array;i.pos=new Array(a),i.cuv=new Float32Array(a),i.fastID=new s(a),i.offsets=new o(e.length),i.sizes=new l(e.length);var u=0;e.forEach((function(t,e){i.offsets[e]=u,i.sizes[e]=t.length,t.forEach((function(n,a){i.pos[u]=n,i.fastID[u]=e,a<=0||a>=t.length-1?i.cuv[u]=0:i.cuv[u]=ht(t[a-1],n,t[a+1]),u++}))})),i.sizes.forEach((function(t,e){var a=i.offsets[e],r=t+a-1;Mt(a,r,n,e,i)}));var d=new Float32Array(i.pos.length);i.sizes.forEach((function(t,e){for(var n=i.offsets[e],a=t+n-1,r=n;r<a;r++){var s=ut(i.pos[r],i.pos[r+1]);d[r]=s,s}d[a]=0})),i.sizes.forEach((function(t,e){for(var n=i.offsets[e],a=t+n-1,r=n+1;r<a;r++){var s=pt(i.pos[r+1],i.pos[r]),o=pt(i.pos[r],i.pos[r-1]);i.pos[r].z=(d[r]*(s.y/s.x)+d[r-1]*(o.y/o.x))/(d[r]+d[r-1]),r===n+1&&(i.pos[n].z=o.y/o.x),r===a-1&&(i.pos[a].z=s.y/s.x)}}));var f=[],p=0;i.sizes.forEach((function(t,e){var n=i.offsets[e],a=t+n,r={aabb:void 0,from:n,to:a-1,sp:[]};f.push(r),Ot(r,i.pos);var s=-1;while(p<i.segIndex.length){var o=i.segIndex[p];if(i.fastID[o[0]]<e)++p;else{if(i.fastID[o[0]]>e){--p;break}s!==o[0]&&r.sp.push(o[0]),r.sp.push(o[1]),s=o[1],++p}}}));var v=[],y=new Map;v.push(f,!1,null,0);while(v.length){var m,g=v.slice(v.length-4,v.length),x=i.pos[g[0][0].from],b=x,w=Object(c["a"])(g[0]);try{for(w.s();!(m=w.n()).done;){var M=m.value;x=mt(M.aabb.a,x),b=gt(M.aabb.b,b)}}catch(Pt){w.e(Pt)}finally{w.f()}var C=pt(b,x),j=[],S=[],O=jt(g[0]),D=!1,L=0,_=0,I=g[3],z=I>2?0:I,A=I>2?2:I;if(I<10)for(var B=z;B<=A;B++)if(!(C[St(L)]<2*X.r)){L=B;var E,T=[],H=Object(c["a"])(g[0]);try{for(H.s();!(E=H.n()).done;){for(var R,P,q=E.value,Y=q.from+1;Y<q.to;Y++){var F,N=null!==(F=i.pos[Y][St(L)])&&void 0!==F?F:0;T.push([N])}var W=null!==(R=i.pos[q.from][St(L)])&&void 0!==R?R:0,$=null!==(P=i.pos[q.to][St(L)])&&void 0!==P?P:0;T.push([W]),T.push([$])}}catch(Pt){H.e(Pt)}finally{H.f()}_=kt(T,.5),j=[],S=[],Dt(L,_,g[0],j,S,i);var et=jt(j),nt=jt(S),it=j.length,at=S.length,rt=(_-x[St(L)])/C[St(L)],st=It(et,nt,O,rt,0,0);if(st<O&&it>=X.k&&at>=X.k&&C[St(L)]*rt>X.r&&C[St(L)]*(1-rt)>X.r){D=!0;break}}if(D){var ot={dim:L,pos:_};null===g[2]?this.root=ot:zt(g[2],ot,g[1]),v.pop(),v.pop(),v.pop(),v.pop(),v.push(j,!0,ot,g[3]+1,S,!1,ot,g[3]+1)}else{this.segs.length;var lt,ct={segs:[]},dt=Object(c["a"])(g[0]);try{for(dt.s();!(lt=dt.n()).done;){var ft,vt=lt.value,yt=vt.from,xt=Object(c["a"])(vt.sp);try{for(xt.s();!(ft=xt.n()).done;){var bt=ft.value;if(yt!=bt){var wt="".concat(i.pos[yt].x,"-").concat(i.pos[bt].x,"-").concat(i.fastID[bt]),Ct=y.get(wt);if(void 0!==Ct)ct.segs.push(Ct);else{var Lt=pt(i.pos[bt],i.pos[yt]),_t=[i.pos[yt],i.pos[bt],Lt.y/Lt.x,i.fastID[bt]],At=this.segs.length;this.segs.push(_t),ct.segs.push(At),y.set(wt,At)}yt=bt}}}catch(Pt){xt.e(Pt)}finally{xt.f()}if(yt!=vt.to){var Bt="".concat(i.pos[yt].x,"-").concat(i.pos[vt.to].x,"-").concat(i.fastID[vt.to]),Et=y.get(Bt);if(void 0!==Et)ct.segs.push(Et);else{var Tt=pt(i.pos[yt],i.pos[vt.to]),Ht=[i.pos[yt],i.pos[vt.to],Tt.y/Tt.x,i.fastID[vt.to]],Rt=this.segs.length;this.segs.push(Ht),ct.segs.push(Rt),y.set(Bt,Rt)}}}}catch(Pt){dt.e(Pt)}finally{dt.f()}this.segs.length;null===g[2]?this.root=ct:zt(g[2],ct,g[1]),v.pop(),v.pop(),v.pop(),v.pop()}}}return Object(S["a"])(t,[{key:"knn",value:function(t,e){$={};var n=new W.a((function(t,e){return e.value-t.value}));return Object(O["a"])(this,Q,nt).call(this,n,{x:t[0],y:t[1]},e,this.root),n.toArray()}},{key:"rnn",value:function(t,e){var n={};return Object(O["a"])(this,K,rt).call(this,n,{x:t[0],y:t[1]},e,this.root),Object.values(n)}},{key:"brush",value:function(t,e){var n=new Set;Object(O["a"])(this,J,ot).call(this,n,{x:t[0],y:t[1],z:-1/0},{x:e[0],y:e[1],z:1/0},{a:{x:-1/0,y:-1/0,z:-1/0},b:{x:1/0,y:1/0,z:1/0}},this.root);var i=new Set;return Object(O["a"])(this,J,ot).call(this,i,{x:t[0],y:t[1]-1,z:-1/0},{x:e[0],y:t[1],z:1/0},{a:{x:-1/0,y:-1/0,z:-1/0},b:{x:1/0,y:1/0,z:1/0}},this.root),Object(O["a"])(this,J,ot).call(this,i,{x:t[0],y:e[1],z:-1/0},{x:e[0],y:e[1]+1,z:1/0},{a:{x:-1/0,y:-1/0,z:-1/0},b:{x:1/0,y:1/0,z:1/0}},this.root),Object(s["a"])(n).filter((function(t){return!i.has(t)}))}},{key:"angular",value:function(t,e){var n=new Set;Object(O["a"])(this,J,ot).call(this,n,{x:t[0],z:t[1],y:-1/0},{x:e[0],z:e[1],y:1/0},{a:{x:-1/0,y:-1/0,z:-1/0},b:{x:1/0,y:1/0,z:1/0}},this.root);var i=new Set;return Object(O["a"])(this,J,ot).call(this,i,{x:t[0],z:e[1],y:-1/0},{x:e[0],z:1/0,y:1/0},{a:{x:-1/0,y:-1/0,z:-1/0},b:{x:1/0,y:1/0,z:1/0}},this.root),Object(O["a"])(this,J,ot).call(this,i,{x:t[0],z:-1/0,y:-1/0},{x:e[0],z:t[1],y:1/0},{a:{x:-1/0,y:-1/0,z:-1/0},b:{x:1/0,y:1/0,z:1/0}},this.root),Object(s["a"])(n).filter((function(t){return!i.has(t)}))}}]),t}(),nt=function t(e,n,i,a){if(a&&!(i<=0)){if(a.segs)return Object(O["a"])(this,V,it).call(this,e,n,i,a);var r=n[St(a.dim)];r<a.pos?(Object(O["a"])(this,Q,t).call(this,e,n,i,a.left),(e.top().value>a.pos-r||e.size()<i)&&Object(O["a"])(this,Q,t).call(this,e,n,i,a.right)):(Object(O["a"])(this,Q,t).call(this,e,n,i,a.right),(e.top().value>r-a.pos||e.size()<i)&&Object(O["a"])(this,Q,t).call(this,e,n,i,a.left))}},it=function(t,e,n,i){var a,r=Object(c["a"])(i.segs);try{for(r.s();!(a=r.n()).done;){var s=a.value,o=this.segs[s],l=pt(e,o[0]),h=pt(o[1],o[0]);l.z=0,h.z=0;var u=Math.sqrt(xt(h,h));h=yt(h,u);var d=xt(l,h),f=o[3],p=void 0,v=void 0;d<=0?(p=dt(o[0],e),v=o[0]):d>=u?(p=dt(o[1],e),v=o[1]):(p=Math.sqrt(xt(l,l)-d*d),v=ft(o[0],vt(h,d)));var y={id:f,value:p,point:v};Object(O["a"])(this,U,at).call(this,t,n,y)}}catch(m){r.e(m)}finally{r.f()}},at=function(t,e,n){void 0===$[n.id]?(t.size()<e?t.push(n):t.pushpop(n),$[n.id]=n):n.value<$[n.id].value&&($[n.id].value=n.value,$[n.id].point=n.point,t.updateItem(n))},rt=function t(e,n,i,a){if(a&&!(i<=0)){if(a.segs)return Object(O["a"])(this,G,st).call(this,e,n,i,a);var r=n[St(a.dim)];r<a.pos?(Object(O["a"])(this,K,t).call(this,e,n,i,a.left),i>a.pos-r&&Object(O["a"])(this,K,t).call(this,e,n,i,a.right)):(Object(O["a"])(this,K,t).call(this,e,n,i,a.right),i>r-a.pos&&Object(O["a"])(this,K,t).call(this,e,n,i,a.left))}},st=function(t,e,n,i){var a,r=Object(c["a"])(i.segs);try{for(r.s();!(a=r.n()).done;){var s=a.value,o=this.segs[s],l=pt(e,o[0]),h=pt(o[1],o[0]);l.z=0,h.z=0;var u=Math.sqrt(xt(h,h));h=yt(h,u);var d=xt(l,h),f=o[3],p=void 0,v=void 0;d<=0?(p=dt(o[0],e),v=o[0]):d>=u?(p=dt(o[1],e),v=o[1]):(p=Math.sqrt(xt(l,l)-d*d),v=ft(o[0],vt(h,d))),p<n&&(void 0===t[f]?t[f]={id:f,value:p,point:v}:t[f].value>p&&(t[f].value=p,t[f].point=v))}}catch(y){r.e(y)}finally{r.f()}},ot=function t(e,n,i,a,r){if(!(n.x>=i.x||n.y>=i.y||n.z>=i.z)&&r){if(r.segs)return Object(O["a"])(this,tt,ct).call(this,e,n,i,r);if(a.a.x>=n.x&&a.a.y>=n.y&&a.a.z>=n.z&&a.b.x<=i.x&&a.b.y<=i.y&&a.b.z<=i.z)return Object(O["a"])(this,Z,lt).call(this,e,n,i,r);var s=n[St(r.dim)],l=i[St(r.dim)],c=!1,u=!1;s>=r.pos&&(c=!0),l<=r.pos&&(u=!0),c||Object(O["a"])(this,J,t).call(this,e,n,i,{a:a.a,b:Object(o["a"])(Object(o["a"])({},a.b),{},Object(h["a"])({},St(r.dim),r.pos))},r.left),u||Object(O["a"])(this,J,t).call(this,e,n,i,{a:Object(o["a"])(Object(o["a"])({},a.a),{},Object(h["a"])({},St(r.dim),r.pos)),b:a.b},r.right)}},lt=function t(e,n,i,a){if(a){if(a.segs)return Object(O["a"])(this,tt,ct).call(this,e,n,i,a);Object(O["a"])(this,Z,t).call(this,e,n,i,a.left),Object(O["a"])(this,Z,t).call(this,e,n,i,a.right)}},ct=function(t,e,n,i){var a,r=Object(c["a"])(i.segs);try{for(r.s();!(a=r.n()).done;){var s=a.value,o=this.segs[s],l=o[3];t.has(l)||(isFinite(e.z)||isFinite(n.z)?o[2]>=e.z&&o[2]<=n.z&&o[0].x<n.x&&o[1].x>e.x&&t.add(l):(o[0].x>=e.x&&o[0].y>=e.y&&o[0].x<=n.x&&o[0].y<=n.y||o[1].x>=e.x&&o[1].y>=e.y&&o[1].x<=n.x&&o[1].y<=n.y||T({x1:o[0].x,y1:o[0].y,x2:o[1].x,y2:o[1].y},{x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}))&&t.add(l))}}catch(h){r.e(h)}finally{r.f()}};function ht(t,e,n){var i=ut(t,e),a=ut(n,e),r=ut(t,n),s=(i*i+a*a-r*r)/2/i/a,o=Math.sqrt(1-wt(s)),l=2*o/r;return l}function ut(t,e){var n,i;return Math.sqrt(wt(t.x-e.x)+wt(t.y-e.y)+wt((null!==(n=t.z)&&void 0!==n?n:0)-(null!==(i=e.z)&&void 0!==i?i:0)))}function dt(t,e){return Math.sqrt(wt(t.x-e.x)+wt(t.y-e.y))}function ft(t,e){var n,i;return{x:t.x+e.x,y:t.y+e.y,z:(null!==(n=t.z)&&void 0!==n?n:0)+(null!==(i=e.z)&&void 0!==i?i:0)}}function pt(t,e){var n,i;return{x:t.x-e.x,y:t.y-e.y,z:(null!==(n=t.z)&&void 0!==n?n:0)-(null!==(i=e.z)&&void 0!==i?i:0)}}function vt(t,e){var n;return{x:t.x*e,y:t.y*e,z:(null!==(n=t.z)&&void 0!==n?n:0)*e}}function yt(t,e){var n;return{x:t.x/e,y:t.y/e,z:(null!==(n=t.z)&&void 0!==n?n:0)/e}}function mt(t,e){var n,i;return{x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),z:Math.min(null!==(n=t.z)&&void 0!==n?n:0,null!==(i=e.z)&&void 0!==i?i:0)}}function gt(t,e){var n,i;return{x:Math.max(t.x,e.x),y:Math.max(t.y,e.y),z:Math.max(null!==(n=t.z)&&void 0!==n?n:0,null!==(i=e.z)&&void 0!==i?i:0)}}function xt(t,e){var n,i;return t.x*e.x+t.y*e.y+(null!==(n=t.z)&&void 0!==n?n:0)*(null!==(i=e.z)&&void 0!==i?i:0)}function bt(t){var e,n,i=Math.sqrt(wt(t.x)+wt(t.y)+wt(null!==(e=t.z)&&void 0!==e?e:0));return{x:t.x/i,y:t.y/i,z:(null!==(n=t.z)&&void 0!==n?n:0)/i}}function wt(t){return t*t}function Mt(t,e,n,i,a){if(!(e<t))if(e-t<=1)Ct(t,e,i,a);else{for(var r=a.pos[t],s=a.pos[e],o=bt(pt(s,r)),l=0,c=t,h=t;h<=e;h++){var u=a.pos[h],d=pt(u,r),f=xt(d,o),p=xt(d,d)-f*f;p>l&&(c=h,l=p)}l<n||c===t||c===e?Ct(t,e,i,a):(Mt(t,c,n,i,a),Mt(c,e,n,i,a))}}function Ct(t,e,n,i){i.lineID.push(n),i.segIndex.push([t,e])}function jt(t){var e,n=0,i=Object(c["a"])(t);try{for(i.s();!(e=i.n()).done;){var a=e.value;n+=a.sp.length+1}}catch(r){i.e(r)}finally{i.f()}return n}function kt(t,e){return t.sort((function(t,e){return t[0]<e[0]})),t[Math.floor(t.length/2)][0]}function St(t){return 0==t?"x":1==t?"y":"z"}function Ot(t,e){var n,i,a=t.from,r=t.to;t.aabb={a:{x:e[a].x,y:e[a].y,z:null!==(n=e[a].z)&&void 0!==n?n:0},b:{x:e[a].x,y:e[a].y,z:null!==(i=e[a].z)&&void 0!==i?i:0}};for(var s=a+1;s<=r;s++){var o,l;t.aabb={a:{x:Math.min(t.aabb.a.x,e[s].x),y:Math.min(t.aabb.a.y,e[s].y),z:Math.min(t.aabb.a.z,null!==(o=e[s].z)&&void 0!==o?o:0)},b:{x:Math.max(t.aabb.b.x,e[s].x),y:Math.max(t.aabb.b.y,e[s].y),z:Math.max(t.aabb.b.z,null!==(l=e[s].z)&&void 0!==l?l:0)}}}}function Dt(t,e,n,i,a,r){var s,o=Object(c["a"])(n);try{for(o.s();!(s=o.n()).done;){var l=s.value,h=l.aabb.a[St(t)],u=l.aabb.b[St(t)];if(h>u){var d=h;h=u,u=d}if(e<=h)a.push(l);else if(e>=u)i.push(l);else{var f=0,p={sp:[]},v=p,y=r.pos[l.from][St(t)]<e;p.from=l.from;for(var m=l.from+1;m<=l.to;m++){var g=r.pos[m][St(t)],x=!1;if(g<e?y||(p.to=m,a.push(p),v=p,Lt(v,r),Ot(v,r.pos),p={sp:[]},p.from=m-1,y=!0,x=!0):y&&(p.to=m,i.push(p),v=p,Lt(v,r),Ot(v,r.pos),p={sp:[]},p.from=m-1,y=!1,x=!0),l.sp.length>f&&(l.sp[f]<m&&++f,l.sp[f]==m))if(x){var b=v.sp;b.push(m)}else{p.sp;p.sp.push(m)}}p.to=l.to,y?(i.push(p),Ot(p,r.pos)):(a.push(p),Ot(p,r.pos))}}}catch(w){o.e(w)}finally{o.f()}}function Lt(t,e){if(t.sp&&0!=t.sp.length)if(1==t.sp.length)_t(t.from,t.sp[0],t.to,e)&&(t.sp=[]);else if(t.sp.length>1){var n=!1,i=!1;_t(t.from,t.sp[0],t.sp[1],e)&&(n=!0),_t(t.sp[t.sp.length-2],t.sp[t.sp.length-1],t.to,e)&&(i=!0),n&&t.sp.shift(),i&&t.sp.pop()}}function _t(t,e,n,i){var a=Math.cos(X.deg/180*Math.PI),r=i.pos[t],s=i.pos[e],o=i.pos[n],l=bt(pt(s,r)),c=bt(pt(o,s)),h=xt(l,c);return isNaN(h)||h>=a}function It(t,e,n,i,a,r,s){var o,l=n/(t+1e-10);if(l<=1)return 1/0;o=Math.log(n)/Math.log(l);var c,h=n/(e+1e-10);if(h<=1)return 1/0;if(0==i||1==i)return 1/0;c=Math.log(n)/Math.log(h);var u=i*t+(1-i)*e,d=.5*(o+c);return u+d*X.b}function zt(t,e,n){n?t.left=e:t.right=e}var At=n("6125"),Bt=n.n(At),Et=n("c1df"),Tt=n.n(Et),Ht={},Rt={props:{timeIndex:Number,valueIndex:Number,timeName:String,valueName:String,filter:Float32Array,option:Object},components:{draggable:v.a},data:function(){return{canvas:null,contextHandler:null,canvasContext:null,rawLineContext:null,filterMode:"brush",brushMethod:"tree",rawMode:"rep",repCount:3,diverse:.1,maxDiverse:1,calculatedMaxDiverse:!1,cursor:"crosshair",mouseDown:!1,listener:null,hoverListener:null,hoveringInd:null,coord:[0,0,0,0,0],boxes:[],maxDensity:null,maxOverlayDensity:null,rawLines:[],colorMap:["aqua","limegreen","lightgreen"],upsideDown:!1,showCursorValue:!0,normalizeDensity:!0,enlargeFont:!1,headers:[],previewIndex:-1,selectedQuery:"$int",tableColumns:[{type:"expand",width:50,render:function(t,e){return t(j,{props:{row:e.row.reps}})}},{title:"Query",align:"center",slot:"name"},{title:"Line series count",align:"center",key:"count"},{title:"Time points count",align:"center",key:"points"},{title:"Min value",align:"center",key:"minV"},{title:"Max value",align:"center",key:"maxV"},{title:"Mean value",align:"center",key:"mean"},{title:"Variance",align:"center",key:"var"},{title:"Operations",align:"center",slot:"op",width:250}],repColumns:[{title:"Index num.",align:"center",key:"name"},{title:"Min start time",align:"center",key:"minT"},{title:"Max start time",align:"center",key:"maxT"},{title:"Min value",align:"center",key:"minV"},{title:"Max value",align:"center",key:"maxV"},{title:"Mean value",align:"center",key:"mean"}],layers:[{id:"rep_layer",name:"representative line",opacity:1},{id:"selectionCanvas",name:"selected density",opacity:0},{id:"selectionLayer",name:"selected line",opacity:.4},{id:"canvas",name:"density",opacity:1},{id:"raw_lines",name:"raw line",opacity:0}],colormapIndexCache:17,colormapOverlayIndexCache:20,initDensityCache:null,initDensityBufferCache:null,initDensityMaxCache:0,currentDensityMax:0,currentDensity:null,distanceCache:{},colorCache:{},querys:[],preview:null,modify:null,mark:!1,selectionLayerContext:null,repLayerContext:null,rawLinesLayerContext:null,mouseLayerContext:null,queryResult:[],xScale:null,yScaleC:null,yScale:null,cursorHelper:null,svg:null,tr:null,cnt:0,renderSelectedDensity:0,repModal:!1,repStaticInformation:[],attributeColumn:null,attributeValue:null,attributeData:[]}},computed:{rawLineNames:function(){return Object(s["a"])(this.rawLines).map((function(t){return y.aggregatedData[t].key}))},upsideDownFactor:function(){return this.upsideDown?-1:1},previewData:function(){var t=this;return this.previewIndex<0?[]:Object(s["a"])(y.aggregatedData[this.previewIndex].ref).slice(0,6).map((function(e,n){return 5==n?t.headers.map((function(t){return"..."})):y.data[e]}))},tableData:function(){var t=this;if(!this.cnt)return[];for(var e=[],n={brush:"Brush",ang:"Angle",knn:"KNN",rnn:"Radius",attr:"Attribute",hover:"Hover"},i=0;i<y.querys.length;i++)y.querys[i].reps||(y.querys[i].reps=this.calcRepLines(Object(s["a"])(y.querys[i].cache))),e.push(Object(o["a"])(Object(o["a"])({_expanded:i==this.selectedQuery,query:i,name:n[y.querys[i].type]},this.getStaticInformation(Object(s["a"])(y.querys[i].cache))),{},{reps:y.querys[i].reps.map((function(e){return Object(o["a"])({id:e,name:y.aggregatedData[e].key,color:"rgb(".concat(t.getColor(e).join(","),")")},t.getStaticInformation([e]))}))}));return y.interReps=this.calcRepLines(y.interResult),e.push(Object(o["a"])(Object(o["a"])({_expanded:"$int"==this.selectedQuery,query:"$int",name:y.querys.length?"intersection":"global"},this.getStaticInformation(y.querys.length?y.interResult:new Array(y.aggregatedData.length).fill().map((function(t,e){return e})))),{},{reps:(y.querys.length?y.interReps:y.globalRep).map((function(e){return Object(o["a"])({id:e,name:y.aggregatedData[e].key,color:"rgb(".concat(t.getColor(e).join(","),")")},t.getStaticInformation([e]))}))})),y.querys.length&&(y.unionReps=this.calcRepLines(y.unionResult),e.push(Object(o["a"])(Object(o["a"])({_expanded:"$uni"==this.selectedQuery,query:"$uni",name:"union"},this.getStaticInformation(y.unionResult)),{},{reps:y.unionReps.map((function(e){return Object(o["a"])({id:e,name:y.aggregatedData[e].key,color:"rgb(".concat(t.getColor(e).join(","),")")},t.getStaticInformation([e]))}))}))),e}},watch:{enlargeFont:function(t){t?(this.svg.select("#xaxis").attr("font-size","16px"),this.svg.select("#yaxis").attr("font-size","16px"),this.svg.select("#xaxis").attr("stroke-width","2px"),this.svg.select("#yaxis").attr("stroke-width","2px")):(this.svg.select("#xaxis").attr("font-size","12px"),this.svg.select("#yaxis").attr("font-size","12px"),this.svg.select("#xaxis").attr("stroke-width","1px"),this.svg.select("#yaxis").attr("stroke-width","1px"))},colormapIndexCache:function(t){console.log(t),this.renderColorMap(),this.renderAllDensity()},colormapOverlayIndexCache:function(){this.renderColorMapOverlay(),this.renderDensity()},repCount:function(t){this.renderBoxes()},layers:{deep:!0,handler:function(t){for(var e in y.layers=t,this.rearrangeLayer(t),t){var n=t[e];"selectionCanvas"===n.id&&(!this.renderSelectedDensity&&n.opacity>0&&this.renderDensity(),this.renderSelectedDensity=n.opacity>0)}}},showCursorValue:function(){this.svg.select("#cursorHelper").selectAll("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0),this.svg.select("#cursorHelper").selectAll("text").attr("x",0).attr("y",0).text("")},upsideDown:function(t){y.upsideDown=t,this.svg.select("#cursorHelper").selectAll("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0),this.svg.select("#cursorHelper").selectAll("text").attr("x",0).attr("y",0).text(""),this.setReverseY(t)},filter:function(t){this.contextHandler.rerender(t),this.getTopK()},contextHandler:function(){this.filter&&this.contextHandler.rerender(this.filter)},filterMode:function(t,e){"hover"===e&&this.initCanvas(y.hoverLayer)},rawMode:function(){this.getTopK()},maxDensity:function(){this.renderAllDensity()},maxOverlayDensity:function(){this.renderDensity()},diverse:function(){var t=this;clearTimeout(y.diverseChange),y.diverseChange=setTimeout((function(){t.renderBoxes(),t.cnt++}),50)},selectedQuery:function(t,e){t!==e&&(this.renderBoxes(),this.renderDensity())},colorMap:function(){var t=this.rawLines;this.rawLineContext.clearRect(0,0,this.option.width,this.option.height);for(var e=this.colorMap,n=0;n<t.length;n++){var i=y.aggregatedData[t[n]];this.rawLineContext.globalAlpha=1,this.rawLineContext.strokeStyle=e[n%3],this.rawLineContext.lineWidth=2,this.rawLineContext.beginPath(),this.rawLineContext.moveTo(i[this.timeIndex][0]/this.contextHandler.maxX*this.option.width,this.option.height-i[this.valueIndex][0]/this.contextHandler.maxY*this.option.height);for(var a=0;a<i[this.timeIndex].length;a++)this.rawLineContext.lineTo(i[this.timeIndex][a]/this.contextHandler.maxX*this.option.width,this.option.height-i[this.valueIndex][a]/this.contextHandler.maxY*this.option.height);this.rawLineContext.stroke()}},normalizeDensity:function(){this.renderAllDensity(!0),this.renderDensity()}},methods:{convertPoint:function(t){return[this.xScale(y.axisXScle.invert(t[0])),this.yScale(y.screenyScale.invert(t[1]))]},reconvertPoint:function(t){return[y.axisXScle(this.xScale.invert(t[0])),y.screenyScale(this.yScale.invert(t[1]))]},inRadius:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=n*n;return e=this.reconvertPoint(e),console.log(y.cache),t.filter((function(t){if(i&&y.cache&&!y.cache.has(t))return!1;for(var n=y.screenResult[t],r=1/0,s=0;s<n.length-1;s++){var o=E(e,[n[s].x,n[s].y],[n[s+1].x,n[s+1].y]);o<r&&(r=o)}return r<=a}))},leaveQuery:function(t){this.mark=!1,this.renderBoxes("mouseLayer")},handleSearch:function(t){if(console.log(t),void 0!==this.attributeColumn&&t.length){var e=y.headers[this.attributeColumn],n=y.headerMap.get(e);console.log(y.headerMap),console.log(e,n,this.attributeValue),this.attributeData=n.filter((function(e){return e.slice(0,t.length)===t})).slice(0,10)}else this.attributeData=[]},hoveringQuery:function(t){console.log(t),t>=y.querys.length||this.hovering(t)},addAttrQuery:function(){y.querys.push({type:"attr",info:{ind:this.attributeColumn,val:this.attributeValue}}),this.renderBoxes(),this.cnt++},deleteAllQuery:function(){y.querys=[],this.renderBoxes(),this.cnt++},deleteQuery:function(t){var e=!1;this.selectedQuery===t&&(e=!0),y.querys.splice(t,1),e&&(this.selectedQuery="$int"),this.renderBoxes(),this.cnt++,this.renderDensity()},canvasMouseleave:function(t){var e=this;"hover"===this.filterMode&&setTimeout((function(){clearTimeout(y.hoverEvent),e.initCanvas(y.hoverLayer)}),100)},canvasMousedown:function(t){if(2!==t.button){var e=this.convertPoint([t.offsetX,t.offsetY]);t.offsetX,t.offsetY;if("hover"===this.filterMode)return console.log(y.querys),y.querys.push({type:"hover",cache:y.hoverCache}),this.renderBoxes(),this.cnt++,void console.log(y.querys);var n=this.findBox(e);if(n)return this.modify=n,this.preview=this.modify.instance,this.modify.lastPos=e,void(this.modify.onBorder?this.modify.type="resize":this.modify.type="drag");"attr"!==this.filterMode&&(this.preview={type:this.filterMode,start:e},y.preview=this.preview,"knn"===this.preview.type?this.preview.n=5:"rnn"===this.preview.type?this.preview.n=10:"ang"===this.preview.type&&(this.preview.n=5))}},canvasMouseup:function(t){if(2!==t.button&&this.preview){if(this.modify)y.querys[this.modify.i]=this.preview,this.modify=this.preview=null;else{if("attr"===this.filterMode)return;var e=this.convertPoint([t.offsetX,t.offsetY]);"knn"===this.preview.type||"rnn"===this.preview.type?this.preview.start=e:"brush"!==this.preview.type&&"ang"!==this.preview.type||(this.preview.end=e),this.preview.cache=null,this.preview.reps=null,y.querys.push(this.preview),this.preview=null}y.preview=this.preview,console.time("renderBoxes in mouseup"),this.renderBoxes(),console.timeEnd("renderBoxes in mouseup"),console.time("render Density in mouseup"),this.renderDensity(),console.timeEnd("render Density in mouseup"),this.cnt++}},canvasWheel:function(t){var e=this,n=this.convertPoint([t.offsetX,t.offsetY]),i=this.findBox(n);if(i){t.preventDefault();var a=i.instance,r=Math.sign(t.deltaY);"knn"!==a.type&&"rnn"!==a.type&&"ang"!==a.type||("ang"===a.type?a.n=Math.min(Math.max(1,a.n-r),180):a.n=Math.max(a.n-Math.sign(t.deltaY),0),a.cache=null,a.reps=null,console.log(a.n)),clearTimeout(y.async),y.async=setTimeout((function(){e.renderBoxes(),e.cnt++}),10)}},canvasMousemove:function(t){var e=this,n=this.convertPoint([t.offsetX,t.offsetY]);if(this.renderAxisHelper(t),"hover"!==this.filterMode)if(this.preview){if(this.modify){if("resize"===this.modify.type)"brush"===this.preview.type?(A(this.preview.end,this.modify.lastPos,n),A(this.preview.start,this.modify.lastPos,n)):"ang"===this.preview.type&&(this.preview.end[0]=n[0],this.preview.end[1]+=n[1]-this.modify.lastPos[1]);else{var i=n[0]-this.modify.lastPos[0],a=n[1]-this.modify.lastPos[1];"brush"!==this.preview.type&&"ang"!==this.preview.type||B(this.preview.end,i,a),B(this.preview.start,i,a)}this.modify.lastPos=n}else"knn"===this.preview.type||"rnn"===this.preview.type?this.preview.start=n:"brush"!==this.preview.type&&"ang"!==this.preview.type||(this.preview.end=n);this.preview.cache=null,console.time("renderBoxes"),clearTimeout(y.async),y.async=setTimeout((function(){e.renderBoxes()}),10),this.renderBoxes(),console.timeEnd("renderBoxes")}else this.findBox(n);else y.hoverEvent=setTimeout((function(){var t=5,i=[];while(0===i.length&&t<100)i=e.inRadius(e.tr.ee.brush([n[0]-t,n[1]-t],[n[0]+t,n[1]+t]),n,3,!0),t*=2;e.initCanvas(y.hoverLayer),y.hoverEvent&&e.drawLineWithLayer(i,y.hoverLayer),y.hoverCache=new Set(i)}),10)},mouseContextmenu:function(t){t.preventDefault()},hoverLines:function(t){var e=this,n=t.offsetX,i=t.offsetY,a=this.contextHandler.filterRange((n-5)/this.option.width,(n+5)/this.option.width,1-(i+5)/this.option.height,1-(i-5)/this.option.height).filter((function(t){return!e.filter||e.filter.includes(t)})).slice(0,3);this.rawLineContext.clearRect(0,0,this.option.width,this.option.height);for(var r=this.colorMap,s=a.length-1;s>=0;s--){var o=y.aggregatedData[a[s]];this.rawLineContext.globalAlpha=1,this.rawLineContext.strokeStyle=r[s%3],this.rawLineContext.lineWidth=2,this.rawLineContext.beginPath(),this.rawLineContext.moveTo(o[this.timeIndex][0]/this.contextHandler.maxX*this.option.width,this.option.height-o[this.valueIndex][0]/this.contextHandler.maxY*this.option.height);for(var l=0;l<o[this.timeIndex].length;l++)this.rawLineContext.lineTo(o[this.timeIndex][l]/this.contextHandler.maxX*this.option.width,this.option.height-o[this.valueIndex][l]/this.contextHandler.maxY*this.option.height);this.rawLineContext.stroke()}this.rawLines=a},getTopK:function(){var t=[];switch(this.hoverListener&&this.$refs.canvas.removeEventListener("mousemove",this.hoverListener),this.rawMode){case"cur":this.hoverListener=this.hoverLines.bind(this),this.$refs.canvas.addEventListener("mousemove",this.hoverListener);break;case"out":t=this.contextHandler.findKTop(!1);break;case"rep":t=this.contextHandler.findKTop(!0,this.diverse);break}this.rawLineContext.clearRect(0,0,this.option.width,this.option.height);for(var e=this.colorMap,n=t.length-1;n>=0;n--){var i=y.aggregatedData[t[n]];this.rawLineContext.globalAlpha=1,this.rawLineContext.strokeStyle=e[n%3],this.rawLineContext.lineWidth=2,this.rawLineContext.beginPath(),this.rawLineContext.moveTo(i[this.timeIndex][0]/this.contextHandler.maxX*this.option.width,this.option.height-i[this.valueIndex][0]/this.contextHandler.maxY*this.option.height);for(var a=0;a<i[this.timeIndex].length;a++)this.rawLineContext.lineTo(i[this.timeIndex][a]/this.contextHandler.maxX*this.option.width,this.option.height-i[this.valueIndex][a]/this.contextHandler.maxY*this.option.height);this.rawLineContext.stroke()}this.rawLines=t},resetFilter:function(){this.$emit("filterChange",void 0),this.boxes=[],this.mouseDown=!1,this.canvasContext.clearRect(0,0,this.option.width,this.option.height),this.coord=[0,0,0,0,0]},startMouse:function(t){var e=this;if(!this.mouseDown){this.mouseDown=!0;var n=t.offsetX,i=t.offsetY,a=!1;if("rect"==this.filterMode){n/=this.option.width,i=1-i/this.option.height;var r,o=Object(c["a"])(this.boxes);try{for(o.s();!(r=o.n()).done;){var l=r.value;if((Math.abs(n-l[0])<=.002||Math.abs(n-l[1])<=.002)&&i>l[2]&&i<l[3]?(Math.abs(n-l[0])<=.002?this.mouseDown="left":this.mouseDown="right",a=!0):(Math.abs(i-l[2])<=.004||Math.abs(i-l[3])<=.004)&&n>l[0]&&n<l[1]?(Math.abs(i-l[2])<=.004?this.mouseDown="bottom":this.mouseDown="top",a=!0):n>l[0]&&n<l[1]&&i>l[2]&&i<l[3]&&(this.mouseDown="move",a=!0),a){var h=function(){e.coord=[l[0]*e.option.width,e.option.height-l[3]*e.option.height,l[1]*e.option.width,e.option.height-l[2]*e.option.height,0],e.boxes.splice(e.boxes.indexOf(l),1);var t=void 0;return e.boxes.forEach((function(n){var i,a=(i=e.contextHandler).filterRange.apply(i,Object(s["a"])(n));t=t?t.filter((function(t){return a.includes(t)})):a})),e.$emit("filterChange",t),"break"}();if("break"===h)break}}}catch(u){o.e(u)}finally{o.f()}}else Math.abs(n-this.coord[0])<=2&&Math.abs(i-this.coord[1])<=2?(this.mouseDown="move",a=!0):Math.abs(n-this.coord[2])<=2&&Math.abs(i-this.coord[3])<=Math.abs(this.coord[4]-this.coord[3])?(this.mouseDown="time",a=!0):n>this.coord[0]&&n<this.coord[2]&&i>this.coord[1]*(this.coord[2]-n)/(this.coord[2]-this.coord[0])+(this.coord[3]-Math.abs(this.coord[4]-this.coord[3]))*(n-this.coord[0])/(this.coord[2]-this.coord[0])&&i<this.coord[1]*(this.coord[2]-n)/(this.coord[2]-this.coord[0])+(this.coord[3]+Math.abs(this.coord[4]-this.coord[3]))*(n-this.coord[0])/(this.coord[2]-this.coord[0])&&(this.mouseDown="angular",a=!0);a||(this.coord=[0,0,0,0,0],this.coord[0]=t.offsetX,this.coord[1]=t.offsetY),this.listener=this.startFilter.bind(this),window.addEventListener("mouseup",this.listener)}},drawBoxes:function(){var t,e=Object(c["a"])(this.boxes);try{for(e.s();!(t=e.n()).done;){var n=t.value;this.canvasContext.fillRect(n[0]*this.option.width,this.option.height-n[3]*this.option.height,(n[1]-n[0])*this.option.width,(n[3]-n[2])*this.option.height)}}catch(i){e.e(i)}finally{e.f()}},cursorShape:function(t){var e=t.offsetX,n=t.offsetY;switch(this.mouseDown){case"move":return void(this.cursor="grabbing");case"left":case"right":case"time":return void(this.cursor="ew-resize");case"top":case"bottom":case"angular":case"range":return void(this.cursor="ns-resize");case"magnet":case!0:return void(this.cursor="crosshair");default:if("rect"==this.filterMode){e/=this.option.width,n=1-n/this.option.height;var i,a=Object(c["a"])(this.boxes);try{for(a.s();!(i=a.n()).done;){var r=i.value;if((Math.abs(e-r[0])<=.002||Math.abs(e-r[1])<=.002)&&n>r[2]&&n<r[3])return void(this.cursor="ew-resize");if((Math.abs(n-r[2])<=.004||Math.abs(n-r[3])<=.004)&&e>r[0]&&e<r[1])return void(this.cursor="ns-resize");if(e>r[0]&&e<r[1]&&n>r[2]&&n<r[3])return void(this.cursor="move")}}catch(s){a.e(s)}finally{a.f()}}else{if(Math.abs(e-this.coord[0])<=2&&Math.abs(n-this.coord[1])<=2)return void(this.cursor="move");if(Math.abs(e-this.coord[2])<=2&&Math.abs(n-this.coord[3])<=Math.abs(this.coord[4]-this.coord[3]))return void(this.cursor="ew-resize");if(e>this.coord[0]&&e<this.coord[2]&&n>this.coord[1]*(this.coord[2]-e)/(this.coord[2]-this.coord[0])+(this.coord[3]-Math.abs(this.coord[4]-this.coord[3]))*(e-this.coord[0])/(this.coord[2]-this.coord[0])&&n<this.coord[1]*(this.coord[2]-e)/(this.coord[2]-this.coord[0])+(this.coord[3]+Math.abs(this.coord[4]-this.coord[3]))*(e-this.coord[0])/(this.coord[2]-this.coord[0]))return void(this.cursor="ns-resize")}this.cursor="crosshair"}},moveMouse:function(t){if(this.cursorShape(t),this.mouseDown)if("magnet"==this.mouseDown?this.coord[4]=t.offsetY:"move"==this.mouseDown?(this.coord[0]+=t.movementX,this.coord[2]+=t.movementX,this.coord[1]+=t.movementY*this.upsideDownFactor,this.coord[3]+=t.movementY*this.upsideDownFactor,this.coord[4]+=t.movementY*this.upsideDownFactor):"left"==this.mouseDown?this.coord[0]=t.offsetX:"right"==this.mouseDown?this.coord[2]=t.offsetX:"bottom"==this.mouseDown?this.coord[3]=t.offsetY:"top"==this.mouseDown?this.coord[1]=t.offsetY:"time"==this.mouseDown?this.coord[2]=Math.max(this.coord[0]+1,t.offsetX):"angular"==this.mouseDown?(this.coord[3]+=t.movementY*this.upsideDownFactor,this.coord[4]+=t.movementY*this.upsideDownFactor):(this.coord[2]=t.offsetX,this.coord[3]=t.offsetY),this.canvasContext.clearRect(0,0,this.option.width,this.option.height),"rect"==this.filterMode)this.canvasContext.globalAlpha=.3,this.canvasContext.fillStyle="black",this.drawBoxes(),this.canvasContext.fillRect(Math.min(this.coord[0],this.coord[2]),Math.min(this.coord[1],this.coord[3]),Math.abs(this.coord[2]-this.coord[0]),Math.abs(this.coord[3]-this.coord[1]));else if(this.canvasContext.globalAlpha=1,this.canvasContext.strokeStyle="black",this.canvasContext.beginPath(),this.canvasContext.moveTo(this.coord[0],this.coord[1]),this.canvasContext.lineTo(this.coord[2],this.coord[3]),this.canvasContext.stroke(),this.mouseDown&&!0!==this.mouseDown){var e=this.coord[4]-this.coord[3];this.canvasContext.beginPath(),this.canvasContext.moveTo(this.coord[2],this.coord[3]-e),this.canvasContext.lineTo(this.coord[2],this.coord[3]+e),this.canvasContext.stroke(),this.canvasContext.globalAlpha=.3,this.canvasContext.fillStyle="black",this.canvasContext.beginPath(),this.canvasContext.moveTo(this.coord[0],this.coord[1]),this.canvasContext.lineTo(this.coord[2],this.coord[3]-e),this.canvasContext.lineTo(this.coord[2],this.coord[3]+e),this.canvasContext.fill()}},startFilter:function(){var t=this;if("rect"==this.filterMode&&(this.mouseDown=!1,0!=this.coord[2]||0!=this.coord[3])){var e=[this.coord[0],this.coord[2]].map((function(e){return e/t.option.width})).sort(),n=Object(l["a"])(e,2),i=n[0],a=n[1],r=[this.coord[1],this.coord[3]].map((function(e){return 1-e/t.option.height})).sort(),s=Object(l["a"])(r,2),o=s[0],c=s[1];this.boxes.push([i,a,o,c]);var h=this.contextHandler.filterRange(i,a,o,c);this.filter?this.$emit("filterChange",this.filter.filter((function(t){return h.includes(t)}))):this.$emit("filterChange",h)}window.removeEventListener("mouseup",this.listener),this.listener=null},angleConfirm:function(){if("ang"==this.filterMode&&this.coord[2]&&this.coord[3]&&this.coord[0]!=this.coord[2])if(!0===this.mouseDown){this.mouseDown="magnet";var t=[0,0],e=[0,0];this.coord[0]<this.coord[2]?(t=this.coord.slice(0,2),e=this.coord.slice(2,4)):(e=this.coord.slice(0,2),t=this.coord.slice(2,4)),this.coord=[].concat(Object(s["a"])(t),Object(s["a"])(e),[0])}else if(this.mouseDown){this.mouseDown=!1;var n=Math.abs(this.coord[4]-this.coord[3]),i=-(this.coord[3]+n-this.coord[1])/(this.coord[2]-this.coord[0]),a=-(this.coord[3]-n-this.coord[1])/(this.coord[2]-this.coord[0]);this.$emit("filterChange",this.contextHandler.filterAngle(this.coord[0]/this.option.width,this.coord[2]/this.option.width,i,a))}},exportFig:function(){u(this.layers.map((function(t){return document.getElementById(t.id)})).reverse(),this.upsideDown,this.layers.map((function(t){return t.opacity})).reverse())},showRepData:function(){var t=this;this.repModal=!0,this.repStaticInformation=y.repIds.map((function(e){return Object(o["a"])({name:e},t.getStaticInformation([e]))}))},hightlightRow:function(t){return t.query===this.selectedQuery?"selected-table-row":""},calClassName:function(t){var e=this.hightlightRow(t)+" "+(t.query===this.hoveringInd?"ivu-table-row-hover":"");return e},calcLineDistance:function(t,e){if(t==e)return 0;if(t>e){var n=[e,t];t=n[0],e=n[1]}if(this.distanceCache[t]||(this.distanceCache[t]={}),void 0!==this.distanceCache[t][e])return this.distanceCache[t][e];var i=0,a=0,r=0,s=0,o=y.result[t],l=y.result[e];while(1){while(r<o.length&&s<l.length&&o[r].x<l[s].x)r++;while(r<o.length&&s<l.length&&o[r].x>l[s].x)s++;if(r>=o.length||s>=l.length)break;o[r].x==l[s].x&&(a++,i+=Math.abs(o[r].y-l[s].y),r++,s++)}return i/=a,a||(i=1/0),this.distanceCache[t][e]=i,i},drawRawLines:function(){var t=y.result.slice().map((function(t,e){return e}));t.sort((function(){return Math.random()>.5?1:-1})),this.drawLineWithLayer(t,y.rawLinesLayerContext)},renderQuerys:function(){var t=this,e=document.getElementById("query_ctner");e.innerHTML="",y.querys.length||(e.innerHTML="(empty)");for(var n=function(n){var i=y.querys[n],a=document.createElement("p"),r=document.createElement("i");r.style.display="inline-block",r.style.background="knn"===i.type?"deepskyblue":"ang"===i.type?"transparent":"gray",r.style.borderRadius="knn"===i.type||"rnn"===i.type?"50%":"0",r.style.borderBottom=r.style.borderRight="ang"===i.type?"6px solid gray":"",r.style.borderLeft=r.style.borderTop="ang"===i.type?"6px solid transparent":"",r.style.height=r.style.width="ang"===i.type?"0":"12px";var s=document.createElement("span");switch(i.type){case"knn":s.innerText="KNN";break;case"rnn":s.innerText="RNN";break;case"brush":s.innerText="Brush";break;case"ang":s.innerText="Angular";break}var o=document.createElement("p");switch(i.type){case"knn":o.innerText="k=";break;case"rnn":o.innerText="r=";break;case"brush":o.innerHTML="(".concat(i.start.map((function(e,n){return 0===n?"date"==y.inferX?Tt()(xScale.invert(e)).format("YYYY-M-D"):xScale.invert(e).toFixed(0):yScale.invert(t.option.height-e).toFixed(0)})).join(", "),") ~<br>(").concat(i.end.map((function(e,n){return 0===n?"date"==y.inferX?Tt()(xScale.invert(e)).format("YYYY-M-D"):xScale.invert(e).toFixed(0):yScale.invert(t.option.height-e).toFixed(0)})).join(", "),")");break;case"ang":o.innerText="degree±";break}var l=document.createElement("input");l.type="number",l.value=i.n,l.addEventListener("change",(function(){i.n=parseFloat(l.value),i.cache=null,i.reps=null,setTimeout(renderBoxes,0)})),"knn"!==i.type&&"rnn"!==i.type&&"ang"!==i.type||o.append(l);var c=document.createElement("button");c.innerText="Delete this query",c.addEventListener("click",(function(){querys.splice(n,1),setTimeout(renderBoxes,0),setTimeout(renderDensity,0)})),a.append(r,s,o,c),a.addEventListener("mouseenter",(function(){a.style.border="1px solid red",hoverBox(i)})),a.addEventListener("mouseleave",(function(){a.style.border="1px solid transparent",renderBoxes()})),e.appendChild(a)},i=0;i<y.querys.length;i++)n(i)},colorSpan:function(t){var e=this;return t.map((function(t){return'<span style="color: rgb('.concat(e.getColor(t).join(","),')">').concat(t,"</span>")}))},renderResult:function(t,e){y.interResult=t,y.unionResult=e},hovering:function(t,e){var n=y.querys[t];this.hoveringInd=t,this.mark!==n&&this.renderBoxes("mouseLayer"),this.mark=n,this.hoverBox(n),document.getElementById("canvas").style.cursor=e?"move":"pointer"},findBox:function(t){function e(t,e){var n=y.querys[t];this.hoveringInd=t,this.mark!==n&&this.renderBoxes("mouseLayer"),this.mark=n,this.hoverBox(n),document.getElementById("canvas").style.cursor=e?"move":"pointer"}for(var n=y.querys.length-1;n>=0;n--){var i=y.querys[n];if("brush"===i.type){var a=Math.min(i.start[0],i.end[0]),r=Math.max(i.start[0],i.end[0]),s=Math.min(i.start[1],i.end[1]),o=Math.max(i.start[1],i.end[1]),l=z(a,t[0])||z(r,t[0])||z(s,t[1])||z(o,t[1]);if(a<=t[0]&&t[0]<=r&&s<=t[1]&&t[1]<=o)return e.call(this,n,l),{instance:i,onBorder:l,i:n}}else if("knn"===i.type||"rnn"===i.type){var c=I(t,i.start);if(_(i.n)>c)return e.call(this,n),{instance:i,i:n}}else if("ang"===i.type){var h=Math.max(i.start[0]+1,i.end[0]),u=i.start,d=[h,i.end[1]],f=z(h,t[0]);if(u[0]<=t[0]&&t[0]<=h&&(u[0]===t[0]&&u[1]===t[1]||u[0]!==t[0]&&Math.abs(L(u,t)-L(u,d))<=i.n/180*Math.PI))return e.call(this,n,f),{instance:i,i:n,onBorder:f}}}this.mark&&(this.mark=!1,document.getElementById("canvas").style.cursor="default",this.renderBoxes("mouseLayer"),this.hoveringInd=null)},renderBox:function(t){var e,n=t.start&&this.reconvertPoint(t.start),i=t.end&&this.reconvertPoint(t.end);if("knn"===t.type){if(y.mouseLayerContext.beginPath(),(e=y.mouseLayerContext).arc.apply(e,Object(s["a"])(this.reconvertPoint(t.start)).concat([6,0,2*Math.PI])),y.mouseLayerContext.fillStyle="deepskyblue",y.mouseLayerContext.fill(),!t.cache){var a=new Set,r=0;while(a.size<t.n)r+=t.n-a.size,a=new Set(this.tr.ee.knn(t.start,r).map((function(t){var e=t.id;return e})));t.cache=a}}else if("rnn"===t.type){var o;if(y.mouseLayerContext.beginPath(),(o=y.mouseLayerContext).arc.apply(o,Object(s["a"])(n).concat([t.n,0,2*Math.PI])),y.mouseLayerContext.fillStyle="rgba(0,0,0,0.3)",y.mouseLayerContext.fill(),!t.cache){var l=new Set(this.inRadius(this.tr.ee.rnn(t.start,t.n).map((function(t){var e=t.id;return e})),t.start,t.n));t.cache=l}}else if("brush"===t.type){var c,h=this.reconvertPoint(t.start),u=this.reconvertPoint(t.end);if(y.mouseLayerContext.fillStyle="rgba(0,0,0,0.3)",(c=y.mouseLayerContext).fillRect.apply(c,Object(s["a"])(h.map((function(t,e){return Math.min(t,u[e])}))).concat(Object(s["a"])(u.map((function(t,e){return Math.abs(t-h[e])}))))),!t.cache){var d=Math.min(t.start[0],t.end[0]),f=Math.max(t.start[0],t.end[0]),p=Math.min(t.start[1],t.end[1]),v=Math.max(t.start[1],t.end[1]);if("seq"===this.brushMethod){var m=[];for(var g in y.result){var x=y.result[g],b=0,w=x.length-1,M=!0;if(!(x[w].x<d||x[b].x>f)){while(b<x.length-1&&x[b].x<d)b++;while(w>0&&x[w].x>f)w--;for(var C=b;M&&C<=w;C++)(x[C].y<p||x[C].y>v)&&(M=!1);if(0!==b){var j=D(x[b-1],x[b],d).y;(j<p||j>v)&&(M=!1)}if(w!==x.length-1){var k=D(x[w],x[w+1],f).y;(k<p||k>v)&&(M=!1)}M&&m.push(g)}}m=new Set(m),t.cache=m}else if("tree"===this.brushMethod){var S=new Set(this.tr.ee.brush([Math.min(t.start[0],t.end[0]),Math.min(t.start[1],t.end[1])],[Math.max(t.start[0],t.end[0]),Math.max(t.start[1],t.end[1])]).filter((function(t){var e,n,i=y.result[t],a=0,r=i.length-1,s=0,o=r;while(a<=r)e=a+r>>1,i[e].x>=d?(s=e,r=e-1):a=e+1;a=0,r=i.length-1;while(a<=r)e=a+r>>1,i[e].x<=f?(o=e,a=e+1):r=e-1;for(var l=s;l<=o;l++)if(i[l].y<p||i[l].y>v)return!1;return!(s&&(n=D(i[s-1],i[s],d).y,n<p||n>v))&&!(o<i.length-1&&(n=D(i[o],i[o+1],d).y,n<p||n>v))})));t.cache=S}else{var O=this.tr.ee.brush([Math.min(t.start[0],t.end[0]),Math.min(t.start[1],t.end[1])],[Math.max(t.start[0],t.end[0]),Math.max(t.start[1],t.end[1])]),L=new Set(O.filter((function(e){var n=e.raw;return T({x1:n[0],x2:n[1],y1:n[2],y2:n[3]},{x:Math.min(t.start[0],t.end[0]),y:Math.min(t.start[1],t.end[1]),width:Math.abs(t.start[0]-t.end[0]),height:Math.abs(t.start[1]-t.end[1])})})).map((function(t){var e=t.raw;return e[5]})));O.filter((function(e){var n=e.raw;return H({x:n[0],y:n[2]},{x:n[1],y:n[3]},{x:Math.min(t.start[0],t.end[0]),y:Math.min(t.start[1],t.end[1])-1},{x:Math.max(t.start[0],t.end[0]),y:Math.min(t.start[1],t.end[1])-1})||H({x:n[0],y:n[2]},{x:n[1],y:n[3]},{x:Math.min(t.start[0],t.end[0]),y:Math.max(t.start[1],t.end[1])+1},{x:Math.max(t.start[0],t.end[0]),y:Math.max(t.start[1],t.end[1])+1})})).forEach((function(t){var e=t.raw;return L.delete(e[5])})),t.cache=L}}}else if("ang"===t.type){var _=Math.max(n[0]+1,i[0]),I=n[0],z=_,A=(i[1]-n[1])/(_-n[0]),B=Math.atan(A),E=Math.min(.5*Math.PI-1e-4,B+t.n/180*Math.PI),R=Math.max(-.5*Math.PI+1e-4,B-t.n/180*Math.PI),P=Math.tan(E),q=Math.tan(R),Y=n[1]+P*(_-n[0]),F=n[1]+q*(_-n[0]);if(y.mouseLayerContext.fillStyle="rgba(0,0,0,0.3)",y.mouseLayerContext.beginPath(),y.mouseLayerContext.moveTo(n[0],n[1]),y.mouseLayerContext.lineTo(_,F),y.mouseLayerContext.lineTo(_,Y),y.mouseLayerContext.closePath(),y.mouseLayerContext.fill(),y.mouseLayerContext.lineWidth=1,y.mouseLayerContext.strokeStyle="black",y.mouseLayerContext.beginPath(),y.mouseLayerContext.moveTo(n[0],n[1]),y.mouseLayerContext.lineTo(_,i[1]),y.mouseLayerContext.stroke(),_=Math.max(t.start[0]+1,t.end[0]),I=t.start[0],z=_,A=(t.end[1]-t.start[1])/(_-t.start[0]),B=Math.atan(A),E=Math.min(.5*Math.PI-1e-4,B+t.n/180*Math.PI),R=Math.max(-.5*Math.PI+1e-4,B-t.n/180*Math.PI),P=Math.tan(E),q=Math.tan(R),Y=t.start[1]+P*(_-t.start[0]),F=t.start[1]+q*(_-t.start[0]),!t.cache){var N=new Set(this.tr.ee.angular([t.start[0],q],[_,P]).filter((function(t){var e,n,i=y.screenResult[t],a=0,r=i.length-1,s=0,o=r;if(i[a].x>z||i[r].x<I)return!1;while(a<=r)e=a+r>>1,i[e].x>=I?(s=e,r=e-1):a=e+1;a=0,r=i.length-1;while(a<=r)e=a+r>>1,i[e].x<=z?(o=e,a=e+1):r=e-1;for(var l=s;l<o;l++)if(n=Math.atan((i[l+1].y-i[l].y)/(i[l+1].x-i[l].x)),n<R||n>E)return!1;return!(s&&(n=Math.atan((i[s-1].y-i[s].y)/(i[s-1].x-i[s].x)),n<R||n>E))&&!(o<i.length-1&&(n=Math.atan((i[o+1].y-i[o].y)/(i[o+1].x-i[o].x)),n<R||n>E))})));t.cache=N}}else if("attr"===t.type&&!t.cache){var W=t.info,X=W.ind,$=W.val;console.log(y.aggregatedData,y.data);var Q=new Array(y.result.length).fill(0).map((function(t,e){return e})).filter((function(t){var e=y.aggregatedData[t].ref[0],n=y.data[e][X];return n===$}));t.cache=new Set(Q)}},hoverBox:function(t){y.mouseLayerContext.lineWidth=2;var e,n=t.start&&this.reconvertPoint(t.start),i=t.end&&this.reconvertPoint(t.end);if("knn"===t.type)y.mouseLayerContext.beginPath(),(e=y.mouseLayerContext).arc.apply(e,Object(s["a"])(this.reconvertPoint(t.start)).concat([6,0,2*Math.PI])),y.mouseLayerContext.strokeStyle="red",y.mouseLayerContext.stroke();else if("rnn"===t.type){var a;y.mouseLayerContext.beginPath(),(a=y.mouseLayerContext).arc.apply(a,Object(s["a"])(this.reconvertPoint(t.start)).concat([t.n,0,2*Math.PI])),y.mouseLayerContext.strokeStyle="red",y.mouseLayerContext.stroke()}else if("brush"===t.type){var r;y.mouseLayerContext.strokeStyle="red",(r=y.mouseLayerContext).strokeRect.apply(r,Object(s["a"])(n.map((function(t,e){return Math.min(t,i[e])}))).concat(Object(s["a"])(i.map((function(t,e){return Math.abs(t-n[e])})))))}else if("ang"===t.type){var o=Math.max(n[0]+1,i[0]),l=(i[1]-n[1])/(o-n[0]),c=Math.atan(l),h=Math.min(.5*Math.PI-1e-4,c+t.n/180*Math.PI),u=Math.max(-.5*Math.PI+1e-4,c-t.n/180*Math.PI),d=Math.tan(h),f=Math.tan(u),p=n[1]+d*(o-n[0]),v=n[1]+f*(o-n[0]);y.mouseLayerContext.strokeStyle="red",y.mouseLayerContext.beginPath(),y.mouseLayerContext.moveTo(n[0],n[1]),y.mouseLayerContext.lineTo(o,v),y.mouseLayerContext.lineTo(o,p),y.mouseLayerContext.closePath(),y.mouseLayerContext.stroke()}},initCanvas:function(t){if("string"===typeof t&&(t=document.getElementById(t).getContext("2d")),t){var e=Math.max(this.option.width,y.screenWidth),n=Math.max(this.option.height,y.screenHeight);t.fillStyle="black",t.globalAlpha=1,t.fillRect(0,0,e,n),t.clearRect(0,0,e,n)}},renderBoxes:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";this.initCanvas(y.mouseLayerContext);var e=Object(s["a"])(y.querys);if(this.preview&&!this.modify&&e.push(this.preview),e.forEach(this.renderBox),"mouseLayer"!==t){if(this.initCanvas(y.selectionLayerContext),this.initCanvas(y.repLayerContext),!this.preview){var n=[],i=[];n=e.reduce((function(t,e){return e.hide?t:new Set(Object(s["a"])(t).filter((function(t){return e.cache.has(t)})))}),(e[0]||{cache:new Set}).cache),i=e.reduce((function(t,e){return e.hide?t:new Set([].concat(Object(s["a"])(t),Object(s["a"])(e.cache)))}),(e[0]||{cache:new Set}).cache),this.renderResult(Object(s["a"])(n),Object(s["a"])(i))}console.time("begin calculate rep line and draw line");var a=this.getSelectedIds();y.cache=y.querys.length?new Set(a):null,this.drawLine(a),console.timeEnd("begin calculate rep line and draw line"),console.log("render boxes ended ==== \n\n")}},getSelectedIds:function(t){return"number"===typeof this.selectedQuery?Object(s["a"])(y.querys[this.selectedQuery].cache):"$int"===this.selectedQuery?y.interResult:y.unionResult},renderAxisHelper:function(t){var e=t.offsetX,n=this.upsideDown?t.offsetY:y.screenHeight-t.offsetY,i=y.axisXScle.invert(e),a=y.screenyScale.invert(y.screenHeight-n),r="date"==y.inferX?Tt()(i).format("YYYY-MM-DD"):i.toFixed(2),s=this.upsideDown,o=this.enlargeFont,l=o?103:70,c=o?22:20,h=o?18:12,u={height:y.screenHeight,width:y.screenWidth};this.showCursorValue?(this.cursorHelper.selectAll("line").each((function(t,i){m["j"](this).attr("x1",0===i?0:e).attr("y1",0===i?u.height-n:s?0:u.height).attr("x2",e).attr("y2",u.height-n).attr("stroke-width",(function(){return o?2:1}))})),this.cursorHelper.selectAll("text").each((function(t,i){m["j"](this).attr("x",0===i?0:e-(e>u.width-l?l:0)).attr("y",0===i?u.height-n+(n>u.height-c?h:0):s?h:u.height).text(0===i?a.toFixed(2):r).attr("font-size",o?20:14)}))):(this.cursorHelper.selectAll("line").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0),this.cursorHelper.selectAll("text").text(""))},getColorMap:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[[[253,231,37],[188,223,39],[122,209,81],[67,191,113],[34,168,132],[33,145,141],[42,120,142],[53,96,141],[65,68,135],[72,37,117],[68,1,84]],[[252,253,191],[254,206,145],[254,159,109],[247,111,92],[222,73,104],[182,55,122],[140,41,129],[101,26,128],[59,15,112],[21,14,55],[0,0,4]],[[252,255,164],[246,214,69],[252,165,10],[243,119,26],[221,81,58],[187,55,85],[147,38,103],[107,23,110],[66,10,104],[23,12,59],[0,0,4]],[[240,249,33],[252,206,37],[252,166,54],[242,131,76],[225,100,98],[203,71,121],[177,42,144],[144,13,164],[106,0,168],[66,3,157],[13,8,135]],[[253,234,69],[234,209,86],[202,186,106],[173,164,118],[148,143,120],[127,124,117],[105,105,112],[77,86,109],[43,68,110],[10,50,106],[0,32,81]],[[144,12,0],[186,34,8],[246,95,24],[255,164,35],[222,221,50],[149,251,81],[77,248,132],[39,215,196],[47,157,245],[74,88,221],[35,23,27]],[[213,239,237],[193,232,224],[167,221,209],[139,210,190],[112,198,169],[88,186,145],[68,173,119],[49,156,93],[32,137,70],[14,119,54],[3,100,41]],[[204,221,236],[186,208,228],[168,194,221],[154,176,212],[145,156,201],[141,133,190],[139,109,178],[138,85,166],[135,60,153],[130,34,135],[115,15,113]],[[244,209,102],[213,202,96],[182,195,92],[152,187,89],[124,178,87],[96,166,86],[75,156,83],[63,143,79],[51,131,74],[37,119,64],[20,108,54]],[[244,209,102],[248,190,92],[248,170,76],[245,152,59],[243,133,42],[239,112,27],[226,98,31],[214,83,34],[197,73,35],[177,66,35],[158,58,38]],[[244,209,102],[246,190,89],[249,170,81],[252,150,78],[246,131,75],[238,115,74],[229,98,73],[219,82,71],[207,66,68],[196,49,65],[183,29,62]],[[211,238,206],[197,232,195],[177,225,187],[155,216,187],[130,206,194],[105,194,202],[81,178,205],[60,159,199],[40,138,189],[22,117,177],[11,96,161]],[[253,220,175],[253,207,155],[253,193,138],[253,173,119],[251,149,98],[246,125,83],[238,101,69],[226,73,50],[211,45,30],[191,19,13],[167,4,3]],[[219,216,234],[200,206,228],[176,195,222],[147,183,216],[114,172,209],[84,159,200],[56,146,187],[28,136,163],[9,127,135],[2,115,107],[1,99,83]],[[219,218,235],[200,206,228],[177,195,222],[151,183,216],[123,172,209],[91,159,201],[58,144,192],[30,127,183],[11,112,171],[5,97,153],[4,82,129]],[[220,201,226],[211,179,215],[206,158,204],[209,134,192],[218,107,178],[225,77,160],[226,49,137],[217,30,111],[198,17,89],[171,7,73],[143,2,58]],[[252,207,204],[252,190,192],[250,169,184],[249,143,175],[245,113,165],[236,83,157],[219,54,149],[196,27,138],[169,8,128],[141,1,121],[112,1,116]],[[239,249,189],[219,241,180],[189,229,181],[148,213,185],[105,197,190],[69,180,194],[44,158,192],[33,130,184],[33,99,170],[35,71,156],[28,49,133]],[[228,244,172],[209,236,160],[185,226,148],[158,214,136],[128,201,124],[98,187,110],[71,170,94],[50,151,80],[32,131,68],[14,114,59],[3,96,52]],[[254,234,161],[254,221,132],[254,204,99],[254,183,70],[252,160,49],[246,137,33],[235,114,21],[219,94,11],[197,76,5],[171,61,3],[143,50,4]],[[254,224,135],[254,209,111],[254,189,89],[254,168,73],[253,144,62],[252,115,53],[249,82,43],[238,52,35],[222,27,32],[202,11,34],[175,2,37]]];return e[t?this.colormapOverlayIndexCache:this.colormapIndexCache]},renderColorMap:function(){document.getElementById("color-map").style.background="linear-gradient(to right, ".concat(this.getColorMap().map((function(t,e,n){return"rgb(".concat(t.join(", "),") ").concat((e/(n.length-1)*100).toFixed(0),"%")})).join(", "),")")},renderColorMapOverlay:function(){document.getElementById("color-map-overlay").style.background="linear-gradient(to right, ".concat(this.getColorMap(!0).map((function(t,e,n){return"rgb(".concat(t.join(", "),") ").concat((e/(n.length-1)*100).toFixed(0),"%")})).join(", "),")")},rgb:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=n?this.colormapOverlayIndexCache:this.colormapIndexCache;if(null===(e=Ht[i])||void 0===e?void 0:e[Math.round(1e4*t)])return Ht[i][Math.round(1e4*t)];var a=this.getColorMap(n),r=Math.floor(10*t);if(t<=0)return a[0];if(t>=1)return a[10];void 0===a[r]&&console.log(a,r,t);var s=a[r].map((function(e,n){return e+(a[r+1][n]-e)*(10*t-r)}));return Ht[i]||(Ht[i]={}),Ht[i][Math.round(1e4*t)]=s,s},renderAllDensity:function(t){var e=this,n=document.getElementById("canvas").getContext("2d");if(!y.slopePixelCache){var i=new Array(this.option.width).fill().map((function(){return new Array(e.option.height).fill().map((function(){return{}}))}));for(var a in y.result)for(var r=y.result[a],s=0;s<r.length-1;s++)q([r[s],r[s+1]],i,a,(r[s+1].y-r[s].y)/(r[s+1].x-r[s].x));y.slopePixelCache=i}console.time("temp canvas");var o=new Float32Array(this.option.width*this.option.height).map((function(t,n){var i=n%e.option.height,a=Math.floor(n/e.option.height),r=Object.values(y.slopePixelCache[a][i]);return e.normalizeDensity?r.reduce((function(t,e){return t+e}),0):r.length}));t&&(this.initDensityBufferCache=o),console.timeEnd("temp canvas"),console.time("render"),n.fillStyle="black",n.globalAlpha=1,n.fillRect(0,0,this.option.width,this.option.height),n.clearRect(0,0,this.option.width,this.option.height);var l=new Uint8ClampedArray(this.option.width*this.option.height*4),c=new ImageData(l,this.option.width,this.option.height),h=Math.ceil(!t&&this.maxDensity||o.reduce((function(t,e){return Math.max(t,e)})));this.maxDensity=h,t&&(this.maxOverlayDensity=h);for(var u={},d=0;d<this.option.width;d++)for(var f=0;f<this.option.height;f++){var p=Math.round(o[d*this.option.height+f]/h*1e4);u[p]||(u[p]=this.rgb(p/1e4));var v=u[p];l.set(v,4*(f*this.option.width+d)),l[4*(f*this.option.width+d)+3]=p<=0?0:255}n.putImageData(c,0,0),console.timeEnd("render"),t&&(this.initDensityMaxCache=h,this.initDensityCache=n.getImageData(0,0,this.option.width,this.option.height)),this.currentDensityMax=h,this.currentDensity=n.getImageData(0,0,this.option.width,this.option.height)},renderDensity:function(){var t=this.getSelectedIds(),e={};t.forEach((function(t){return e[t]=1}));var n=!1;for(var i in this.layers){var a=this.layers[i];"selected density"===a.name&&a.opacity>0&&(n=!0)}if(n){var r=document.getElementById("selectionCanvas").getContext("2d");console.time("render"),r.fillStyle="black",r.globalAlpha=1,r.fillRect(0,0,this.option.width,this.option.height),r.clearRect(0,0,this.option.width,this.option.height);for(var s=new Uint8ClampedArray(this.option.width*this.option.height*4),o=new ImageData(s,this.option.width,this.option.height),l=this.maxOverlayDensity,c=0;c<this.option.width;c++)for(var h=0;h<this.option.height;h++){var u=0,d=Object.entries(y.slopePixelCache[c][h]);u=this.normalizeDensity?d.reduce((function(t,n){return t+(e[n[0]]?n[1]:0)}),0):d.reduce((function(t,n){return t+(e[n[0]]?1:0)}),0);var f=u/l,p=this.rgb(f,!0);s.set(p,4*(h*this.option.width+c)),s[4*(h*this.option.width+c)+3]=f<=0?0:255}r.putImageData(o,0,0),console.timeEnd("render"),this.currentDensityMax=l,this.currentDensity=r.getImageData(0,0,this.option.width,this.option.height)}},rearrangeLayer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[{name:"raw_lines",opacity:0,zIndex:0},{name:"canvas",opacity:1,zIndex:1},{name:"selectionCanvas",opacity:0,zIndex:2},{name:"selectionLayer",opacity:.4,zIndex:3},{name:"rep_layer",opacity:1,zIndex:4}];for(var e in t){var n=t[e],i=document.getElementById(n.id);i.style.opacity=n.opacity,i.style.zIndex="".concat(6-e)}},setReverseY:function(){console.log("before set",this.yScale.range()),this.yScale.range(this.upsideDown?[0,this.option.height]:[this.option.height,0]),y.screenyScale.range(this.upsideDown?[0,y.screenHeight]:[y.screenHeight,0]),console.log("after set",this.yScale.range());for(var t="scaleY(".concat(this.upsideDown?-1:1,")"),e=["canvas","selectionCanvas","selectionLayer","rep_layer","raw_lines","mouseLayer","hoverLayer"],n=0,i=e;n<i.length;n++){var a=i[n];document.getElementById(a).style.transform=t}this.svg.select("#xaxis").remove(),this.svg.select("#yaxis").remove(),this.svg.append("g").attr("id","yaxis").attr("transform","translate(50,20)").call(y.yAxis),this.svg.append("g").attr("id","xaxis").attr("transform","translate(50,".concat(this.upsideDown?20:y.screenHeight+20,")")).call(this.upsideDown?y.xAxisR:y.xAxis)},getStaticInformation:function(t){var e=this;if(!t||!t.length)return{};var n=m["g"](t,(function(t){return y.result[t][0].x})),i=m["e"](t,(function(t){return y.result[t][0].x})),a=m["g"](t,(function(t){return m["g"](y.result[t],(function(t){return e.yScaleC.invert(t.y)}))})),r=m["e"](t,(function(t){return m["e"](y.result[t],(function(t){return e.yScaleC.invert(t.y)}))})),s=t.map((function(t){return m["f"](y.result[t],(function(t){return e.yScaleC.invert(t.y)}))})),o=m["f"](s),l=s.length>1?m["k"](s):m["k"](y.result[t[0]],(function(t){return e.yScaleC.invert(t.y)}));return{minT:Tt()(this.xScale.invert(n)).format("YYYY-M-D"),maxT:Tt()(this.xScale.invert(i)).format("YYYY-M-D"),minV:a.toFixed(2),maxV:r.toFixed(2),count:t.length,points:t.reduce((function(t,e){var n,i;return null!==(n=t+(null===(i=y.result[e])||void 0===i?void 0:i.length))&&void 0!==n?n:0}),0),mean:o.toFixed(2),var:l.toFixed(2)}},getColor:function(t){if(this.colorCache[t])return this.colorCache[t];function e(t,e,n){var i=[t,e,n].map((function(t){return t/=255,t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}));return.2126*i[0]+.7152*i[1]+.0722*i[2]}function n(t,n){var i=e(t[0],t[1],t[2]),a=e(n[0],n[1],n[2]),r=Math.max(i,a),s=Math.min(i,a);return(r+.05)/(s+.05)}var i=Bt()(t),a=new Array(3).fill(0).map((function(){return Math.floor(255*i())}));while(n(a,[255,255,255])<3)a=new Array(3).fill(0).map((function(){return Math.floor(255*i())}));return this.colorCache[t]=a,a},calcRepLines:function(t){var e=this;console.time("calc line weight");var n=this.repCount,i=t.map((function(t){return{id:t,w:e.calcLineWeight(t)}}));return console.timeEnd("calc line weight"),i.sort((function(t,e){return e.w[0]*Math.sqrt(e.w[1])-t.w[0]*Math.sqrt(t.w[1])})),i.reduce((function(t,i){return t.length>=n?t:(i.cur=R(y.result[i.id].filter((function(t){return y.querys.length<=0&&!y.preview||(y.preview?[y.preview]:y.querys).find((function(e){if("knn"===e.type)return!0;if("rnn"===e.type)return Math.sqrt(Math.pow(t.x-e.start[0],2)+Math.pow(t.y-e.start[1],2))<=e.n;if("brush"===e.type){var n=Math.min(e.start[0],e.end[0]),i=Math.min(e.start[1],e.end[1]),a=Math.max(e.start[0],e.end[0]),r=Math.max(e.start[1],e.end[1]);return t.x>=n&&t.y>=i&&t.x<=a&&t.y<=r}if("ang"===e.type){var s=Math.min(e.start[0],e.end[0]),o=Math.max(e.start[0],e.end[0]);return t.x>=s&&t.x<=o}}))}))),t.find((function(t){return P(t.cur,i.cur)<e.diverse}))||t.push(i),t)}),[]).map((function(t){return t.id}))},drawLineWithLayer:function(t,e){var n=Math.min(Math.max(1,y.screenHeight/this.option.height),5);e.lineWidth=n;var i,a=Object(c["a"])(t);try{for(a.s();!(i=a.n()).done;){var r=i.value,s=y.screenResult[r];e.strokeStyle="rgb(".concat(this.getColor(r).join(","),")"),e.beginPath(),e.moveTo(s[0].x,s[0].y);var o,l=Object(c["a"])(s);try{for(l.s();!(o=l.n()).done;){var h=o.value;e.lineTo(h.x,h.y)}}catch(u){l.e(u)}finally{l.f()}e.stroke()}}catch(u){a.e(u)}finally{a.f()}},drawLine:function(t){this.preview&&(t=t.slice(0,5)),this.preview||(this.drawLineWithLayer(t,y.selectionLayerContext),y.selectedLines=t),this.preview?t=Object(s["a"])(this.preview.cache):y.querys.length||(t=new Array(y.result.length).fill(0).map((function(t,e){return e})));var e=this.calcRepLines(t);y.querys.length||(y.globalRep=e),this.drawLineWithLayer(e,y.repLayerContext),y.repIds=e},calcLineWeight:function(t){for(var e=0,n=0,i=0,a=y.querys.find((function(t){return"brush"===t.type})),r=y.querys.filter((function(t){return"brush"===t.type})).map((function(t){return[Math.min(t.start[0],t.end[0]),Math.max(t.start[0],t.end[0]),Math.min(t.start[1],t.end[1]),Math.max(t.start[1],t.end[1])]})),s=y.result[t],o=this.option.width,l=this.option.height,c=this.initDensityBufferCache,h=function(t){var h=Math.floor(s[t+1].x),u=Math.floor(s[t+1].y),d=Math.floor(s[t].x),f=Math.floor(s[t].y),p=Math.abs(h-d),v=d<h?1:-1,y=-Math.abs(u-f),m=f<u?1:-1,g=p+y,x=void 0,b=!1,w=d,M=f,C=0;while(!b)(!a||r.find((function(t){return t[0]<=w&&t[1]>=w&&t[2]<=M&&t[3]>=M})))&&w>=0&&w<o&&M>=0&&M<l&&(e+=c[w*l+M],n++,w!==C&&(C=w,i++)),w===h&&M===u?b=!0:(x=2*g,x>=y&&(g+=y,w+=v),x<=p&&(g+=p,M+=m))},u=0;u<s.length-1;u++)h(u);return e/=n,isFinite(e)&&!isNaN(e)||(e=1e-5),a||(y.weightCache[t]=[e*Math.sqrt(i),s[s.length-1].x-s[0].x]),[e*Math.sqrt(i),s[s.length-1].x-s[0].x]}},mounted:function(){var t=this;y.screenWidth=1e3,y.screenHeight=500;for(var e=y.screenWidth+"px",n=y.screenHeight+"px",i=["blank-div","canvas","selectionCanvas"],a=0,r=i;a<r.length;a++){var o=r[a],l=document.getElementById(o);console.log(l),l.style.width=e,l.style.height=n}y.querys=[],y.weightCache=[],y.layers=this.layers,y.upsideDown=this.upsideDown,this.headers=y.headers.map((function(t,e){return{title:t,key:e,minWidth:150}}));var c=new Map,h=[];y.headers.forEach((function(){h.push(new Set)})),y.data.forEach((function(t){t.forEach((function(t,e){h[e].add(t)}))})),y.headers.forEach((function(t,e){c.set(t,Object(s["a"])(h[e]))})),y.headerMap=c;var u=y.aggregatedData;console.log(u);var d=m["g"](u,(function(e){return m["g"](e[t.timeIndex])})),f=m["e"](u,(function(e){return m["e"](e[t.timeIndex])})),p=m["g"](u,(function(e){return m["g"](e[t.valueIndex])})),v=m["e"](u,(function(e){return m["e"](e[t.valueIndex])}));console.log(d,f,p,v);var g=m["h"]().domain([d,f]).range([0,this.option.width]);this.xScale="date"==y.inferX?m["i"]().domain([new Date(3600*d*24*1e3),new Date(3600*f*24*1e3)]).range([0,this.option.width]):g,this.yScale=m["h"]().domain([p,v]).range([this.option.height,0]),this.yScaleC=this.yScale.copy(),y.screenXScale=g.copy().range([0,y.screenWidth]),y.axisXScle=this.xScale.copy().range([0,y.screenWidth]),y.screenyScale=this.yScale.copy().range([y.screenHeight,0]),y.screenyScaleC=this.yScale.copy().range([y.screenHeight,0]);var x=[],b=[],w=u.map((function(e){var n=[];return e[t.timeIndex].forEach((function(i,a){b.push([i,g(i)]),n.push({x:g(i),y:t.yScale(e[t.valueIndex][a])})})),n})),M=u.map((function(e){var n=[];return e[t.timeIndex].forEach((function(i,a){x.push([i,y.screenXScale(i)]),n.push({x:y.screenXScale(i),y:y.screenyScale(e[t.valueIndex][a])})})),n}));y.result=w,y.screenResult=M;this.tr={},this.tr.ee=new et(w),console.log(this.tr.ee),this.renderAllDensity(!0),this.renderDensity(),y.selectionLayerContext=document.getElementById("selectionLayer").getContext("2d"),y.mouseLayerContext=document.getElementById("mouseLayer").getContext("2d"),y.repLayerContext=document.getElementById("rep_layer").getContext("2d"),y.rawLinesLayerContext=document.getElementById("raw_lines").getContext("2d"),y.hoverLayer=document.getElementById("hoverLayer").getContext("2d"),this.svg=m["j"](document.getElementById("axisHelper")),this.cursorHelper=m["j"](document.getElementById("cursorHelper"));var C=m["a"](y.axisXScle),j=m["c"](y.axisXScle),k=m["b"](y.screenyScale);y.yAxis=k,y.xAxis=C,y.xAxisR=j,this.svg.append("g").attr("id","xaxis").attr("transform","translate(50,".concat(y.screenHeight+20,")")).call(C),this.svg.append("g").attr("id","yaxis").attr("transform","translate(50,20)").call(k),this.renderBoxes(),this.drawRawLines(),this.rearrangeLayer(this.layers),this.cnt++,this.renderColorMap(),this.renderColorMapOverlay();var S=document.getElementById("informationTable");S.addEventListener("mousemove",(function(e){var n=null;if(e.path.length>=18&&(n=e.path[e.path.length-18]),n&&"tr"===n.tagName.toLowerCase()&&"tbody"===n.parentNode.tagName.toLowerCase()){for(var i,a=n.parentNode.children,r=0,s=0;s<a.length;s++){var o,l=a[s];if((null===(o=l.className)||void 0===o?void 0:o.includes("ivu-table-row"))&&r++,l===n){i=r-1;break}}if(i>=y.querys.length)return t.renderBoxes("mouseLayer"),void(t.hoveringInd=null);t.hoveringQuery(i)}else t.hoveringInd=null,t.renderBoxes("mouseLayer")})),S.addEventListener("mouseleave",(function(){t.renderBoxes("mouseLayer"),t.hoveringInd=null}))},beforeDestroy:function(){this.contextHandler&&this.contextHandler.destroy()}},Pt=Rt,qt=(n("0c4e"),Object(M["a"])(Pt,d,f,!1,null,null,null)),Yt=qt.exports,Ft=n("86ec"),Nt=n.n(Ft),Wt=n("bc3a"),Xt=n.n(Wt),$t=function(t,e,n,i){function a(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{l(i.next(t))}catch(e){r(e)}}function o(t){try{l(i["throw"](t))}catch(e){r(e)}}function l(t){t.done?n(t.value):a(t.value).then(s,o)}l((i=i.apply(t,e||[])).next())}))},Qt=function(t,e){var n,i,a,r,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(t){return function(e){return l([t,e])}}function l(r){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,i&&(a=2&r[0]?i["return"]:r[0]?i["throw"]||((a=i["return"])&&a.call(i),0):i.next)&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){s.label=r[1];break}if(6===r[0]&&s.label<a[1]){s.label=a[1],a=r;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(r);break}a[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(o){r=[6,o],i=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Vt=[n("9833").default,n("8802").default,n("51f2").default,n("5a12").default,n("8b69").default];function Ut(t){return $t(this,void 0,void 0,(function(){var e,n;return Qt(this,(function(i){switch(i.label){case 0:return[4,Xt.a.get(Vt[t-1])];case 1:return e=i.sent(),n=Nt()(e.data,{skip_empty_lines:!0}),[2,n]}}))}))}function Kt(t){return $t(this,void 0,void 0,(function(){return Qt(this,(function(e){return[2,new Promise((function(e){var n=new FileReader;n.onload=function(){e(Nt()(n.result,{skip_empty_lines:!0}))},n.readAsText(t)}))]}))}))}var Gt=n("aeb1"),Jt=n.n(Gt);function Zt(t,e){switch(e){case"string":return 0;case"date":return Math.floor(new Date(t)/864e5);case"number":return parseFloat(t)}}var te={name:"App",components:{CanvasBox:Yt},data:function(){return{canvasWidth:1e3,canvasHeight:500,width:1e3,height:500,headers:[],inferTypes:[],aggregateAttr:0,timeAttr:0,valueAttr:0,chartConfigs:[],filters:[],layers:[{id:"rep_layer",name:"representative line",opacity:1},{id:"selectionCanvas",name:"selected density",opacity:0},{id:"selectionLayer",name:"selected line",opacity:.4},{id:"canvas",name:"density",opacity:1},{id:"raw_lines",name:"raw line",opacity:0}]}},methods:{eventHandler:function(t){var e=this;this.$Spin.show(),t.startsWith("1")?Ut(t.split("-")[1]).then((function(t){e.$Spin.hide(),e.preProcessData(t),e.generateCharts()})):"2"==t&&(this.$refs.upload.handleClick(),this.$Spin.hide())},readFileHandler:function(t){var e=this;return this.$Spin.show(),Kt(t).then((function(t){e.$Spin.hide(),e.preProcessData(t),e.generateCharts()})),!1},preProcessData:function(t){this.headers=t[0],y.headers=t[0],y.data=t.slice(1),t.length>1&&(this.inferTypes=t[1].map((function(t){if(t.includes("-")||t.includes("/")){var e=new Date(t).toString();return e.startsWith("Invalid")?"string":"date"}return/^\d*(\.\d*)?$/.test(t)?"number":"string"})),this.aggregateAttr=this.inferTypes.indexOf("string"),this.timeAttr=this.inferTypes.indexOf("date"),this.aggregateAttr<0&&(this.aggregateAttr=0),this.timeAttr<0&&(this.timeAttr=this.inferTypes.indexOf("number"),this.aggregateAttr===this.timeAttr&&(this.timeAttr=this.inferTypes.indexOf("number",this.aggregateAttr+1))),this.timeAttr<0&&(this.timeAttr=0),this.valueAttr=this.inferTypes.indexOf("number"),this.valueAttr!==this.timeAttr&&this.valueAttr!==this.aggregateAttr||(this.valueAttr=this.inferTypes.indexOf("number",this.timeAttr+1)),this.valueAttr<0&&(this.valueAttr=0))},generateCharts:function(){var t=this;if(this.width=this.canvasWidth,this.height=this.canvasHeight,this.$Spin.show(),this.headers[this.aggregateAttr]!=(this.chartConfigs.length&&this.chartConfigs[0].aggregateName)||!this.chartConfigs.find((function(e){return e.valueIndex===t.valueAttr}))){var e;y.aggregatedData=[];var n=new Map,i=(e={},Object(h["a"])(e,this.timeAttr,this.inferTypes[this.timeAttr]),Object(h["a"])(e,this.valueAttr,this.inferTypes[this.valueAttr]),e);y.data.forEach((function(e,a){var r,s,o=e[t.aggregateAttr];n.has(o)?r=n.get(o):(s={ref:[]},Object(h["a"])(s,t.timeAttr,[]),Object(h["a"])(s,t.valueAttr,[]),r=s,n.set(o,r));r.ref.push(a),r[t.timeAttr].push(Zt(e[t.timeAttr],i[t.timeAttr])),r[t.valueAttr].push(Zt(e[t.valueAttr],i[t.valueAttr]))}));var a,r=Object(c["a"])(n.entries());try{for(r.s();!(a=r.n()).done;){var s=Object(l["a"])(a.value,2),u=s[0],d=s[1];y.aggregatedData.push(Object.entries(d).reduce((function(t,e){return Object(o["a"])(Object(o["a"])({},t),{},Object(h["a"])({},e[0],new Float32Array(e[1])))}),{key:u}))}}catch(f){r.e(f)}finally{r.f()}n.clear()}this.valueAttr===this.timeAttr?this.chartConfigs=[]:(this.chartConfigs=[{aggregateIndex:this.aggregateAttr,timeIndex:this.timeAttr,valueIndex:this.valueAttr,aggregateName:this.headers[this.aggregateAttr],timeName:this.headers[this.timeAttr],valueName:this.headers[this.valueAttr],filter:void 0,emitFilter:void 0}],y.aggregateName=this.headers[this.aggregateAttr],y.slopePixelCache=null,y.inferX=this.inferTypes[this.timeAttr]),this.filters=this.chartConfigs.map((function(t){})),this.$Spin.hide()},handleFilterChange:function(t,e){var n=this;if(this.filters.splice(t,1,e),this.filters.find((function(t){return t}))){var i=new Float32Array(new Set(this.filters.reduce((function(t,e){return[].concat(Object(s["a"])(t),Object(s["a"])(e||[]))}),[]).filter((function(t){return!n.filters.find((function(e){return!(e&&e.includes(t))}))}))));this.chartConfigs.forEach((function(t){n.$set(t,"filter",i)}))}else this.chartConfigs.forEach((function(t){n.$set(t,"filter",void 0)}))},exportFig:function(){u(y.layers.map((function(t){return document.getElementById(t.id)})).reverse(),y.upsideDown,y.layers.map((function(t){return t.opacity})).reverse())},exportData:function(t){var e=this,n=y[t?"repIds":"selectedLines"];if(n&&n.length){var i="",a=-1,r=y.data.filter((function(t){return t[e.aggregateAttr]!==i&&(a++,i=t[e.aggregateAttr]),!!n.includes(a)}));Jt()(y.headers.join(",")+"\n"+r.map((function(t){return t.join(",")})).join("\n"),"export.csv","text/csv")}}}},ee=te,ne=(n("5c0b"),Object(M["a"])(ee,a,r,!1,null,null,null)),ie=ne.exports,ae=n("f825"),re=n.n(ae),se=(n("f8ce"),n("3250")),oe=n.n(se);i["default"].use(re.a,{locale:oe.a}),i["default"].config.productionTip=!1,new i["default"]({render:function(t){return t(ie)}}).$mount("#app");var le=document.createElement("canvas"),ce=le.getContext("webgl"),he=ce.getExtension("WEBGL_debug_renderer_info");ce.getParameter(he.UNMASKED_RENDERER_WEBGL).toLowerCase()},"5a12":function(t,e,n){"use strict";n.r(e),e["default"]=n.p+"795f7099aa693d52f5fcf4efb9c47976.csv"},"5c0b":function(t,e,n){"use strict";var i=n("9c0c"),a=n.n(i);a.a},"72cd":function(t,e,n){"use strict";var i=n("936d"),a=n.n(i);a.a},8802:function(t,e,n){"use strict";n.r(e),e["default"]=n.p+"455214f84fb18c0faf82859fa62bd0ae.csv"},"8b69":function(t,e,n){"use strict";n.r(e),e["default"]=n.p+"0e775b5251260720ce1235fc0b4d6138.csv"},"936d":function(t,e,n){},9833:function(t,e,n){"use strict";n.r(e),e["default"]=n.p+"b9c8219653d8ec39d5473283116881ee.csv"},"9c0c":function(t,e,n){}});
//# sourceMappingURL=app.59b31da0.js.map